!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function t(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{a(n.next(t))}catch(t){i(t)}}function l(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,l)}a((n=n.apply(t,e||[])).next())}))}var e="undefined"!=typeof self?self:void 0,r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(t){return t&&l.indexOf(Object.prototype.toString.call(t))>-1};function u(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function h(t){return"string"!=typeof t&&(t=String(t)),t}function c(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function f(t){this.map={},t instanceof f?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function p(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function y(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function g(t){var e=new FileReader,r=y(e);return e.readAsArrayBuffer(t),r}function d(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(t){var e;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:o&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:i&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:r&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&o&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=d(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||a(t))?this._bodyArrayBuffer=d(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t,e,r,n=p(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,r=y(e),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(t,e){t=u(t),e=h(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},f.prototype.delete=function(t){delete this.map[u(t)]},f.prototype.get=function(t){return t=u(t),this.has(t)?this.map[t]:null},f.prototype.has=function(t){return this.map.hasOwnProperty(u(t))},f.prototype.set=function(t,e){this.map[u(t)]=h(e)},f.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},f.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),c(t)},f.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),c(t)},f.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),c(t)},n&&(f.prototype[Symbol.iterator]=f.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(t,e){var r,n,o=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new f(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new f(e.headers)),this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),v.indexOf(n)>-1?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function x(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(o))}})),e}function w(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"",this.headers=new f(e.headers),this.url=e.url||"",this._initBody(t)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},m.call(b.prototype),m.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},w.error=function(){var t=new w(null,{status:0,statusText:""});return t.type="error",t};var E=[301,302,303,307,308];w.redirect=function(t,e){if(-1===E.indexOf(e))throw new RangeError("Invalid status code");return new w(null,{status:e,headers:{location:t}})};var S=e.DOMException;function k(t,r){return new Promise((function(n,i){var l=new b(t,r);if(l.signal&&l.signal.aborted)return i(new S("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var t,e,r={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new f,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var r=t.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();e.append(n,o)}})),e)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;setTimeout((function(){n(new w(o,r))}),0)},a.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){i(new S("Aborted","AbortError"))}),0)},a.open(l.method,function(t){try{return""===t&&e.location.href?e.location.href:t}catch(e){return t}}(l.url),!0),"include"===l.credentials?a.withCredentials=!0:"omit"===l.credentials&&(a.withCredentials=!1),"responseType"in a&&(o?a.responseType="blob":s&&l.headers.get("Content-Type")&&-1!==l.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),l.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),l.signal&&(l.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&l.signal.removeEventListener("abort",u)}),a.send(void 0===l._bodyInit?null:l._bodyInit)}))}"function"!=typeof S&&((S=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack}).prototype=Object.create(Error.prototype),S.prototype.constructor=S),k.polyfill=!0,e.fetch||(e.fetch=k,e.Headers=f,e.Request=b,e.Response=w);class _{constructor(t){this.queryObject=t}toString(t=!0){var e=this.queryObject.entityType,r=[];if(this.queryObject.id){if(!t)return`${this.queryObject.entityType}(${this.queryObject.id})`;e=`${e}(${this.queryObject.id})`,delete this.queryObject.id}for(var n in this.queryObject.pathSuffix&&(e=`${e}/${this.queryObject.pathSuffix}`),this.queryObject)(this.queryObject[n]||0==this.queryObject[n])&&("select"!=n?"expand"!=n?"entityType"!=n&&"pathSuffix"!=n&&r.push(`$${n}=${this.queryObject[n].toString()}`):r.push("$expand="+this.queryObject.expand.map(t=>new _(t).toString(!1)).join(",")):r.push("$select="+this.queryObject.select.join(",")));return 0==r.length?e:t?`${e}?${r.join("&")}`:`${e}(${r.join(";")})`}}class P{constructor(t){this.baseUrl=t}getGeoJson(e){return(e=JSON.parse(JSON.stringify(e))).count=!0,new Promise((r,n)=>t(this,void 0,void 0,(function*(){var t=`${this.baseUrl}/${new _(e).toString()}`,n=yield(yield fetch(t)).json(),o=n["@iot.nextLink"];for(r(n);o;){var i=yield(yield fetch(o)).json();n.value.push(...i.value),o=i["@iot.nextLink"]}r(n)})))}}
/**
     * splaytree v3.0.1
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */class I{constructor(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}}function O(t,e){return t>e?1:t<e?-1:0}function T(t,e,r){const n=new I(null,null);let o=n,i=n;for(;;){const n=r(t,e.key);if(n<0){if(null===e.left)break;if(r(t,e.left.key)<0){const t=e.left;if(e.left=t.right,t.right=e,null===(e=t).left)break}i.left=e,i=e,e=e.left}else{if(!(n>0))break;if(null===e.right)break;if(r(t,e.right.key)>0){const t=e.right;if(e.right=t.left,t.left=e,null===(e=t).right)break}o.right=e,o=e,e=e.right}}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function A(t,e,r,n){const o=new I(t,e);if(null===r)return o.left=o.right=null,o;const i=n(t,(r=T(t,r,n)).key);return i<0?(o.left=r.left,o.right=r,r.left=null):i>=0&&(o.right=r.right,o.left=r,r.right=null),o}function R(t,e,r){let n=null,o=null;if(e){const i=r((e=T(t,e,r)).key,t);0===i?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}class C{constructor(t=O){this._root=null,this._size=0,this._comparator=t}insert(t,e){return this._size++,this._root=A(t,e,this._root,this._comparator)}add(t,e){const r=new I(t,e);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);const n=this._comparator,o=T(t,this._root,n),i=n(t,o.key);return 0===i?this._root=o:(i<0?(r.left=o.left,r.right=o,o.left=null):i>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root}remove(t){this._root=this._remove(t,this._root,this._comparator)}_remove(t,e,r){let n;if(null===e)return null;return 0===r(t,(e=T(t,e,r)).key)?(null===e.left?n=e.right:(n=T(t,e.left,r),n.right=e.right),this._size--,n):e}pop(){let t=this._root;if(t){for(;t.left;)t=t.left;return this._root=T(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null}findStatic(t){let e=this._root;const r=this._comparator;for(;e;){const n=r(t,e.key);if(0===n)return e;e=n<0?e.left:e.right}return null}find(t){return this._root&&(this._root=T(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}contains(t){let e=this._root;const r=this._comparator;for(;e;){const n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1}forEach(t,e){let r=this._root;const n=[];let o=!1;for(;!o;)null!==r?(n.push(r),r=r.left):0!==n.length?(r=n.pop(),t.call(e,r),r=r.right):o=!0;return this}range(t,e,r,n){const o=[],i=this._comparator;let s,l=this._root;for(;0!==o.length||l;)if(l)o.push(l),l=l.left;else{if(l=o.pop(),s=i(l.key,e),s>0)break;if(i(l.key,t)>=0&&r.call(n,l))return this;l=l.right}return this}keys(){const t=[];return this.forEach(({key:e})=>t.push(e)),t}values(){const t=[];return this.forEach(({data:e})=>t.push(e)),t}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}at(t){let e=this._root,r=!1,n=0;const o=[];for(;!r;)if(e)o.push(e),e=e.left;else if(o.length>0){if(e=o.pop(),n===t)return e;n++,e=e.right}else r=!0;return null}next(t){let e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}const n=this._comparator;for(;e;){const o=n(t.key,e.key);if(0===o)break;o<0?(r=e,e=e.left):e=e.right}return r}prev(t){let e=this._root,r=null;if(null!==t.left){for(r=t.left;r.right;)r=r.right;return r}const n=this._comparator;for(;e;){const o=n(t.key,e.key);if(0===o)break;o<0?e=e.left:(r=e,e=e.right)}return r}clear(){return this._root=null,this._size=0,this}toList(){return function(t){let e=t;const r=[];let n=!1;const o=new I(null,null);let i=o;for(;!n;)e?(r.push(e),e=e.left):r.length>0?(e=i=i.next=r.pop(),e=e.right):n=!0;return i.next=null,o.next}(this._root)}load(t,e=[],r=!1){let n=t.length;const o=this._comparator;if(r&&function t(e,r,n,o,i){if(n>=o)return;const s=e[n+o>>1];let l=n-1,a=o+1;for(;;){do{l++}while(i(e[l],s)<0);do{a--}while(i(e[a],s)>0);if(l>=a)break;let t=e[l];e[l]=e[a],e[a]=t,t=r[l],r[l]=r[a],r[a]=t}t(e,r,n,a,i),t(e,r,a+1,o,i)}(t,e,0,n-1,o),null===this._root)this._root=function t(e,r,n,o){const i=o-n;if(i>0){const s=n+Math.floor(i/2),l=e[s],a=r[s],u=new I(l,a);return u.left=t(e,r,n,s),u.right=t(e,r,s+1,o),u}return null}(t,e,0,n),this._size=n;else{const r=function(t,e,r){const n=new I(null,null);let o=n,i=t,s=e;for(;null!==i&&null!==s;)r(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;null!==i?o.next=i:null!==s&&(o.next=s);return n.next}(this.toList(),function(t,e){const r=new I(null,null);let n=r;for(let r=0;r<t.length;r++)n=n.next=new I(t[r],e[r]);return n.next=null,r.next}(t,e),o);n=this._size+n,this._root=function t(e,r,n){const o=n-r;if(o>0){const i=r+Math.floor(o/2),s=t(e,r,i),l=e.head;return l.left=s,e.head=e.head.next,l.right=t(e,i+1,n),l}return null}({head:r},0,n)}return this}isEmpty(){return null===this._root}get size(){return this._size}get root(){return this._root}toString(t=(t=>String(t.key))){const e=[];return function t(e,r,n,o,i){if(e){o(`${r}${n?"└── ":"├── "}${i(e)}\n`);const s=r+(n?"    ":"│   ");e.left&&t(e.left,s,!1,o,i),e.right&&t(e.right,s,!0,o,i)}}(this._root,"",!0,t=>e.push(t),t),e.join("")}update(t,e,r){const n=this._comparator;let{left:o,right:i}=R(t,this._root,n);n(t,e)<0?i=A(e,r,i,n):o=A(e,r,o,n),this._root=function(t,e,r){return null===e?t:(null===t||((e=T(t.key,e,r)).left=t),e)}(o,i,n)}split(t){return R(t,this._root,this._comparator)}}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function M(t,e,r){return e&&z(t.prototype,e),r&&z(t,r),t}var N=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},j=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var r=t.ll.x<e.ll.x?e.ll.x:t.ll.x,n=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:r,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:n,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},U=Number.EPSILON;void 0===U&&(U=Math.pow(2,-52));var F=U*U,D=function(t,e){if(-U<t&&t<U&&-U<e&&e<U)return 0;var r=t-e;return r*r<F*t*e?0:t<e?-1:1},G=function(){function t(){B(this,t),this.reset()}return M(t,[{key:"reset",value:function(){this.xRounder=new $,this.yRounder=new $}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),$=function(){function t(){B(this,t),this.tree=new C,this.round(0)}return M(t,[{key:"round",value:function(t){var e=this.tree.add(t),r=this.tree.prev(e);if(null!==r&&0===D(e.key,r.key))return this.tree.remove(t),r.key;var n=this.tree.next(e);return null!==n&&0===D(e.key,n.key)?(this.tree.remove(t),n.key):t}}]),t}(),q=new G,V=function(t,e){return t.x*e.y-t.y*e.x},J=function(t,e){return t.x*e.x+t.y*e.y},H=function(t,e,r){var n={x:e.x-t.x,y:e.y-t.y},o={x:r.x-t.x,y:r.y-t.y},i=V(n,o);return D(i,0)},Y=function(t){return Math.sqrt(J(t,t))},Z=function(t,e,r){var n={x:e.x-t.x,y:e.y-t.y},o={x:r.x-t.x,y:r.y-t.y};return J(o,n)/Y(o)/Y(n)},W=function(t,e,r){return 0===e.y?null:{x:t.x+e.x/e.y*(r-t.y),y:r}},X=function(t,e,r){return 0===e.x?null:{x:r,y:t.y+e.y/e.x*(r-t.x)}},K=function(){function t(e,r){B(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return M(t,null,[{key:"compare",value:function(e,r){var n=t.comparePoints(e.point,r.point);return 0!==n?n:(e.point!==r.point&&e.link(r),e.isLeft!==r.isLeft?e.isLeft?1:-1:tt.compare(e.segment,r.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),M(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,r=0,n=e.length;r<n;r++){var o=e[r];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var r=this.point.events[e];if(void 0===r.segment.consumedBy)for(var n=e+1;n<t;n++){var o=this.point.events[n];void 0===o.consumedBy&&(r.otherSE.point.events===o.otherSE.point.events&&r.segment.consume(o.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,r=this.point.events.length;e<r;e++){var n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,r=new Map,n=function(n){var o,i,s,l,a,u=n.otherSE;r.set(n,{sine:(o=e.point,i=t.point,s=u.point,l={x:i.x-o.x,y:i.y-o.y},a={x:s.x-o.x,y:s.y-o.y},V(a,l)/Y(a)/Y(l)),cosine:Z(e.point,t.point,u.point)})};return function(t,e){r.has(t)||n(t),r.has(e)||n(e);var o=r.get(t),i=o.sine,s=o.cosine,l=r.get(e),a=l.sine,u=l.cosine;return i>=0&&a>=0?s<u?1:s>u?-1:0:i<0&&a<0?s<u?-1:s>u?1:0:a<i?-1:a>i?1:0}}}]),t}(),Q=0,tt=function(){function t(e,r,n,o){B(this,t),this.id=++Q,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=n,this.windings=o}return M(t,null,[{key:"compare",value:function(t,e){var r=t.leftSE.point.x,n=e.leftSE.point.x,o=t.rightSE.point.x,i=e.rightSE.point.x;if(i<r)return 1;if(o<n)return-1;var s=t.leftSE.point.y,l=e.leftSE.point.y,a=t.rightSE.point.y,u=e.rightSE.point.y;if(r<n){if(l<s&&l<a)return 1;if(l>s&&l>a)return-1;var h=t.comparePoint(e.leftSE.point);if(h<0)return 1;if(h>0)return-1;var c=e.comparePoint(t.rightSE.point);return 0!==c?c:-1}if(r>n){if(s<l&&s<u)return-1;if(s>l&&s>u)return 1;var f=e.comparePoint(t.leftSE.point);if(0!==f)return f;var p=t.comparePoint(e.rightSE.point);return p<0?1:p>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(o<i){var y=e.comparePoint(t.rightSE.point);if(0!==y)return y}if(o>i){var g=t.comparePoint(e.rightSE.point);if(g<0)return 1;if(g>0)return-1}if(o!==i){var d=a-s,m=o-r,v=u-l,b=i-n;if(d>m&&v<b)return 1;if(d<m&&v>b)return-1}return o>i?1:o<i||a<u?-1:a>u?1:t.id<e.id?-1:t.id>e.id?1:0}}]),M(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,r=this.rightSE.point,n=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;var o=(t.y-e.y)/n.y,i=e.x+o*n.x;if(t.x===i)return 0;var s=(t.x-e.x)/n.x,l=e.y+s*n.y;return t.y===l?0:t.y<l?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),r=t.bbox(),n=j(e,r);if(null===n)return null;var o=this.leftSE.point,i=this.rightSE.point,s=t.leftSE.point,l=t.rightSE.point,a=N(e,s)&&0===this.comparePoint(s),u=N(r,o)&&0===t.comparePoint(o),h=N(e,l)&&0===this.comparePoint(l),c=N(r,i)&&0===t.comparePoint(i);if(u&&a)return c&&!h?i:!c&&h?l:null;if(u)return h&&o.x===l.x&&o.y===l.y?null:o;if(a)return c&&i.x===s.x&&i.y===s.y?null:s;if(c&&h)return null;if(c)return i;if(h)return l;var f=function(t,e,r,n){if(0===e.x)return X(r,n,t.x);if(0===n.x)return X(t,e,r.x);if(0===e.y)return W(r,n,t.y);if(0===n.y)return W(t,e,r.y);var o=V(e,n);if(0==o)return null;var i={x:r.x-t.x,y:r.y-t.y},s=V(i,e)/o,l=V(i,n)/o;return{x:(t.x+l*e.x+(r.x+s*n.x))/2,y:(t.y+l*e.y+(r.y+s*n.y))/2}}(o,this.vector(),s,t.vector());return null===f?null:N(n,f)?q.round(f.x,f.y):null}},{key:"split",value:function(e){var r=[],n=void 0!==e.events,o=new K(e,!0),i=new K(e,!1),s=this.rightSE;this.replaceRightSE(i),r.push(i),r.push(o);var l=new t(o,s,this.rings.slice(),this.windings.slice());return K.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),K.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(o.checkForConsuming(),i.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,r=this.windings.length;e<r;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var r=this,n=e;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var o=t.compare(r,n);if(0!==o){if(o>0){var i=r;r=n,n=i}if(r.prev===n){var s=r;r=n,n=s}for(var l=0,a=n.rings.length;l<a;l++){var u=n.rings[l],h=n.windings[l],c=r.rings.indexOf(u);-1===c?(r.rings.push(u),r.windings.push(h)):r.windings[c]+=h}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys,o=0,i=this.rings.length;o<i;o++){var s=this.rings[o],l=this.windings[o],a=e.indexOf(s);-1===a?(e.push(s),r.push(l)):r[a]+=l}for(var u=[],h=[],c=0,f=e.length;c<f;c++)if(0!==r[c]){var p=e[c],y=p.poly;if(-1===h.indexOf(y))if(p.isExterior)u.push(y);else{-1===h.indexOf(y)&&h.push(y);var g=u.indexOf(p.poly);-1!==g&&u.splice(g,1)}}for(var d=0,m=u.length;d<m;d++){var v=u[d].multiPoly;-1===n.indexOf(v)&&n.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(ht.type){case"union":var r=0===t.length,n=0===e.length;this._isInResult=r!==n;break;case"intersection":var o,i;t.length<e.length?(o=t.length,i=e.length):(o=e.length,i=t.length),this._isInResult=i===ht.numMultiPolys&&o<i;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var l=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=l(t)!==l(e);break;default:throw new Error("Unrecognized operation type found ".concat(ht.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,r,n){var o,i,s,l=K.comparePoints(e,r);if(l<0)o=e,i=r,s=1;else{if(!(l>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));o=r,i=e,s=-1}return new t(new K(o,!0),new K(i,!1),[n],[s])}}]),t}(),et=function(){function t(e,r,n){if(B(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=q.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,l=e.length;s<l;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=q.round(e[s][0],e[s][1]);a.x===i.x&&a.y===i.y||(this.segments.push(tt.fromRing(i,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),i=a)}o.x===i.x&&o.y===i.y||this.segments.push(tt.fromRing(i,o,this))}return M(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.segments.length;e<r;e++){var n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}]),t}(),rt=function(){function t(e,r){if(B(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new et(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new et(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=r}return M(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,r=this.interiorRings.length;e<r;e++)for(var n=this.interiorRings[e].getSweepEvents(),o=0,i=n.length;o<i;o++)t.push(n[o]);return t}}]),t}(),nt=function(){function t(e,r){if(B(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new rt(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=r}return M(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++)for(var n=this.polys[e].getSweepEvents(),o=0,i=n.length;o<i;o++)t.push(n[o]);return t}}]),t}(),ot=function(){function t(e){B(this,t),this.events=e;for(var r=0,n=e.length;r<n;r++)e[r].segment.ringOut=this;this.poly=null}return M(t,null,[{key:"factory",value:function(e){for(var r=[],n=0,o=e.length;n<o;n++){var i=e[n];if(i.isInResult()&&!i.ringOut){for(var s=null,l=i.leftSE,a=i.rightSE,u=[l],h=l.point,c=[];s=l,l=a,u.push(l),l.point!==h;)for(;;){var f=l.getAvailableLinkedEvents();if(0===f.length){var p=u[0].point,y=u[u.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(y.x,", ").concat(y.y,"]."))}if(1===f.length){a=f[0].otherSE;break}for(var g=null,d=0,m=c.length;d<m;d++)if(c[d].point===l.point){g=d;break}if(null===g){c.push({index:u.length,point:l.point});var v=l.getLeftmostComparator(s);a=f.sort(v)[0].otherSE;break}var b=c.splice(g)[0],x=u.splice(b.index);x.unshift(x[0].otherSE),r.push(new t(x.reverse()))}r.push(new t(u))}}return r}}]),M(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],r=1,n=this.events.length-1;r<n;r++){var o=this.events[r].point,i=this.events[r+1].point;0!==H(o,t,i)&&(e.push(o),t=o)}if(1===e.length)return null;var s=e[0],l=e[1];0===H(s,t,l)&&e.shift(),e.push(e[0]);for(var a=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:e.length-1,h=this.isExteriorRing()?e.length:-1,c=[],f=u;f!=h;f+=a)c.push([e[f].x,e[f].y]);return c}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,r=this.events.length;e<r;e++){var n=this.events[e];K.compare(t,n)>0&&(t=n)}for(var o=t.segment.prevInResult(),i=o?o.prevInResult():null;;){if(!o)return null;if(!i)return o.ringOut;if(i.ringOut!==o.ringOut)return i.ringOut.enclosingRing()!==o.ringOut?o.ringOut:o.ringOut.enclosingRing();o=i.prevInResult(),i=o?o.prevInResult():null}}}]),t}(),it=function(){function t(e){B(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return M(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,r=this.interiorRings.length;e<r;e++){var n=this.interiorRings[e].getGeom();null!==n&&t.push(n)}return t}}]),t}(),st=function(){function t(e){B(this,t),this.rings=e,this.polys=this._composePolys(e)}return M(t,[{key:"getGeom",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++){var n=this.polys[e].getGeom();null!==n&&t.push(n)}return t}},{key:"_composePolys",value:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var o=t[r];if(!o.poly)if(o.isExteriorRing())e.push(new it(o));else{var i=o.enclosingRing();i.poly||e.push(new it(i)),i.poly.addInterior(o)}}return e}}]),t}(),lt=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tt.compare;B(this,t),this.queue=e,this.tree=new C(r),this.segments=[]}return M(t,[{key:"process",value:function(t){var e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;var n=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!n)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var o=n,i=n,s=void 0,l=void 0;void 0===s;)null===(o=this.tree.prev(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);for(;void 0===l;)null===(i=this.tree.next(i))?l=null:void 0===i.key.consumedBy&&(l=i.key);if(t.isLeft){var a=null;if(s){var u=s.getIntersection(e);if(null!==u&&(e.isAnEndpoint(u)||(a=u),!s.isAnEndpoint(u)))for(var h=this._splitSafely(s,u),c=0,f=h.length;c<f;c++)r.push(h[c])}var p=null;if(l){var y=l.getIntersection(e);if(null!==y&&(e.isAnEndpoint(y)||(p=y),!l.isAnEndpoint(y)))for(var g=this._splitSafely(l,y),d=0,m=g.length;d<m;d++)r.push(g[d])}if(null!==a||null!==p){var v=null;if(null===a)v=p;else if(null===p)v=a;else{v=K.comparePoints(a,p)<=0?a:p}this.queue.remove(e.rightSE),r.push(e.rightSE);for(var b=e.split(v),x=0,w=b.length;x<w;x++)r.push(b[x])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&l){var E=s.getIntersection(l);if(null!==E){if(!s.isAnEndpoint(E))for(var S=this._splitSafely(s,E),k=0,_=S.length;k<_;k++)r.push(S[k]);if(!l.isAnEndpoint(E))for(var P=this._splitSafely(l,E),I=0,O=P.length;I<O;I++)r.push(P[I])}}this.tree.remove(e)}return r}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var n=t.split(e);return n.push(r),void 0===t.consumedBy&&this.tree.insert(t),n}}]),t}(),at="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ut="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ht=new(function(){function t(){B(this,t)}return M(t,[{key:"run",value:function(t,e,r){ht.type=t,q.reset();for(var n=[new nt(e,!0)],o=0,i=r.length;o<i;o++)n.push(new nt(r[o],!1));if(ht.numMultiPolys=n.length,"difference"===ht.type)for(var s=n[0],l=1;l<n.length;)null!==j(n[l].bbox,s.bbox)?l++:n.splice(l,1);if("intersection"===ht.type)for(var a=0,u=n.length;a<u;a++)for(var h=n[a],c=a+1,f=n.length;c<f;c++)if(null===j(h.bbox,n[c].bbox))return[];for(var p=new C(K.compare),y=0,g=n.length;y<g;y++)for(var d=n[y].getSweepEvents(),m=0,v=d.length;m<v;m++)if(p.insert(d[m]),p.size>at)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new lt(p),x=p.size,w=p.pop();w;){var E=w.key;if(p.size===x){var S=E.segment;throw new Error("Unable to pop() ".concat(E.isLeft?"left":"right"," SweepEvent ")+"[".concat(E.point.x,", ").concat(E.point.y,"] from segment #").concat(S.id," ")+"[".concat(S.leftSE.point.x,", ").concat(S.leftSE.point.y,"] -> ")+"[".concat(S.rightSE.point.x,", ").concat(S.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(p.size>at)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>ut)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var k=b.process(E),_=0,P=k.length;_<P;_++){var I=k[_];void 0===I.consumedBy&&p.insert(I)}x=p.size,w=p.pop()}q.reset();var O=ot.factory(b.segments);return new st(O).getGeom()}}]),t}());const ct={union:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return ht.run("union",t,r)},intersection:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return ht.run("intersection",t,r)},xor:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return ht.run("xor",t,r)},difference:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return ht.run("difference",t,r)}};class ft{constructor(t){this.cache={},this.config=t,this.api=new P(t.baseUrl)}long2tile(t,e){return Math.floor((t+180)/360*Math.pow(2,e))}lat2tile(t,e){return Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}tile2long(t,e){return t/Math.pow(2,e)*360-180}tile2lat(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}coordinatesToOsm(t,e){return{lat:this.tile2long(this.long2tile(t.lat,e),e),lng:this.tile2lat(this.lat2tile(t.lng,e),e)}}coordinatesToOsmBottom(t,e){return{lat:this.tile2long(this.long2tile(t.lat,e)+1,e),lng:this.tile2lat(this.lat2tile(t.lng,e)+1,e)}}getOSMBoundingBox(t,e){var r={lat:0,lng:0},n={lat:0,lng:0},o=this.long2tile(e[0],t),i=this.lat2tile(e[1],t);r.lat=this.tile2long(o+1,t),r.lng=this.tile2lat(i,t);var s=this.long2tile(e[2],t),l=this.lat2tile(e[3],t);return n.lat=this.tile2long(s,t),n.lng=this.tile2lat(l+1,t),[r.lat,r.lng,n.lat,n.lng]}getLayerData(e,r){return t(this,void 0,void 0,(function*(){var n=JSON.parse(JSON.stringify(this.config.queryObject));if("Things"==n.entityType)n.select=["id"],n.expand=[{entityType:"Locations"}];else{if("FeaturesOfInterest"!=n.entityType)throw new Error("Only Things and FeaturesOfInterest are supported");n.select=["feature"]}if(this.config.cluster||null==this.config.cluster){this.cache[e]||(this.cache[e]={type:"FeatureCollection",features:[]}),n.count=!0,n.top=0;for(var o={lat:this.lat2tile(r[1],e),lng:this.long2tile(r[0],e)},i={lat:this.lat2tile(r[3],e),lng:this.long2tile(r[2],e)},s=[],l=[],a=i.lng;a<=o.lng;a++)for(var u=o.lat;u<=i.lat;u++){const r={lat:this.tile2lat(u,e),lng:this.tile2long(a,e)},o={lat:this.tile2lat(u+1,e),lng:this.tile2long(a+1,e)},i=JSON.parse(JSON.stringify(n)),s=gt([[[r.lng,r.lat],[r.lng,o.lat],[o.lng,o.lat],[o.lng,r.lat],[r.lng,r.lat]]],i.entityType);i.filter?i.filter=`(${i.filter}) and ${s}`:i.filter=s;const h={type:"Feature",geometry:{type:"Polygon",coordinates:[[[r.lng,r.lat],[r.lng,o.lat],[o.lng,o.lat],[o.lng,r.lat],[r.lng,r.lat]]]},properties:{count:0}};this.cache[e].features.find(t=>pt(h,t))||l.push(new Promise((e,r)=>t(this,void 0,void 0,(function*(){var t=yield this.api.getGeoJson(i);0!=t["@iot.count"]?(h.properties.count=t["@iot.count"],e(h)):e(null)}))))}(yield Promise.all(l)).forEach(t=>{t&&s.push(t)});var h=[],c=[];s.forEach(t=>{t.properties.count<=this.config.clusterMin?h.push(t.geometry.coordinates):c.push(t)}),this.cache[e].features.push(...c),yield this.getMarkers(h,e)}else{var f=this.getOSMBoundingBox(e,r),p=f[0],y=f[1],g=f[2],d=f[3],m=`geo.intersects(${"Things"==n.entityType?"Locations/location":"feature"},geography'POLYGON ((${p} ${y}, ${p} ${d}, ${g} ${d}, ${g} ${y} ,${p} ${y}))')`;n.filter?n.filter=`(${n.filter}) and ${m}`:n.filter=m,n.top||(n.top=1e3);var v,b=yield this.api.getGeoJson(n);if(b)v="Things"==n.entityType?b.value.map(t=>t.Locations[0].location):b.value.map(t=>"Point"==t.feature.type?{type:"Feature",geometry:t.feature}:t.feature),this.cache[e]||(this.cache[e]={type:"FeatureCollection",features:[]}),this.cache[e].features.push(...v)}return this.cache[e]}))}getMarkers(e,r){return t(this,void 0,void 0,(function*(){if(0!=e.length){var n=ct.union(...e);if(n){var o=JSON.parse(JSON.stringify(this.config.queryObject));if(o.top=1e3,"Things"==o.entityType){o.expand||(o.expand=[]);var i=o.expand.find(t=>"Datastreams"==t.entityType);i?(i.select||(i.select=["id","name","unitOfMeasurement"]),i.select.includes("id")||i.select.push("id"),i.select.includes("name")||i.select.push("name"),i.select.includes("unitOfMeasurement")||i.select.push("unitOfMeasurement")):o.expand.push({entityType:"Datastreams",select:["id","name","unitOfMeasurement"],expand:[{entityType:"observedProperty"}]}),o.expand.some(t=>"Locations"==t.entityType)||o.expand.push({entityType:"Locations"})}else o.select&&!o.select.includes("feature")&&o.select.push("feature"),o.expand=[{entityType:"Observations",top:1,expand:[{entityType:"Datastream",select:["unitOfMeasurement","id"],expand:[{entityType:"observedProperty"}]}]}];o.filter&&(o.filter=`(${o.filter}) and `),o.filter=o.filter?o.filter:""+gt(n,o.entityType),(yield this.api.getGeoJson(o)).value.forEach(e=>{var n;if("Point"==(n="Things"==o.entityType?e.Locations[0].location:e.feature).type&&(n={type:"Feature",geometry:n}),delete e.Locations,n.properties=e,e.getData||(e.getData={}),"Things"==o.entityType)for(var i of e.Datastreams){const r=i["@iot.id"],n=i.unitOfMeasurement;e.getData[i.ObservedProperty.name]=function(e){var o={entityType:"Datastreams",id:r,pathSuffix:"Observations",filter:e,resultFormat:"dataArray",orderby:"phenomenonTime asc",top:1e3};return new Promise((e,r)=>t(this,void 0,void 0,(function*(){var t=yield this.api.getGeoJson(o);t.unitOfMeasurement=n,e(t)})))}.bind(this)}else{const r=e.Observations[0].Datastream,n=r["@iot.id"],o=r.unitOfMeasurement;e.getData[r.ObservedProperty.name]=function(e){var r={entityType:"Datastreams",id:n,pathSuffix:"Observations",filter:e,resultFormat:"dataArray",orderby:"phenomenonTime asc",top:1e3};return new Promise((e,n)=>t(this,void 0,void 0,(function*(){var t=yield this.api.getGeoJson(r);t.unitOfMeasurement=o,e(t)})))}.bind(this)}this.cache[r].features.some(t=>pt(n,t))||this.cache[r].features.push(n)})}}}))}}function pt(t,e){return t.type==e.type&&("Point"==t.type?yt(t.coordinates,e.coordinates):yt(t.geometry.coordinates,e.geometry.coordinates))}function yt(t,e){return JSON.stringify(t)===JSON.stringify(e)}function gt(t,e){return t.map(t=>(null!=t[0][0][0]&&(t=t[0]),`geo.intersects(${"Things"==e?"Locations/location":"feature"},geography'POLYGON ((${t.map(t=>t.join(" ")).join(",")}))')`)).join(" or ")}var dt={blueIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),goldIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),redIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),greenIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orangeIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellowIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),violetIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),greyIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),blackIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})};function mt(t){switch(t){case"green":return dt.greenIcon;case"black":return dt.blackIcon;case"blue":return dt.blueIcon;case"grey":return dt.greyIcon;case"violet":return dt.violetIcon;case"yellow":return dt.yellowIcon;case"red":return dt.redIcon;case"orange":return dt.orangeIcon;case"gold":return dt.goldIcon;default:return new L.Icon.Default}}var vt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var bt,xt,wt=function(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}((function(t){var e,r;e=vt,r=function(){function t(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType}function e(){var t=[];return{watch:t.push.bind(t),trigger:function(e,r){for(var n=!0,o={detail:r,preventDefault:function(){n=!1}},i=0;i<t.length;i++)t[i](e,o);return n}}}function r(t){return"none"===window.getComputedStyle(t).display}function n(t){this.elem=t}function o(t,e){return n.make(t("parent")).clazz("pico-overlay").clazz(t("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(t("overlayStyles",{opacity:.5,background:"#000"})).onClick((function(){t("overlayClose",!0)&&e()}))}n.make=function(t,e){"string"==typeof t&&(t=document.querySelector(t));var r=document.createElement(e||"div");return(t||document.body).appendChild(r),new n(r)},n.prototype={child:function(t){return n.make(this.elem,t)},stylize:function(t){for(var e in void 0!==(t=t||{}).opacity&&(t.filter="alpha(opacity="+100*t.opacity+")"),t)t.hasOwnProperty(e)&&(this.elem.style[e]=t[e]);return this},clazz:function(t){return this.elem.className+=" "+t,this},html:function(e){return t(e)?this.elem.appendChild(e):this.elem.innerHTML=e,this},onClick:function(t){return this.elem.addEventListener("click",t),this},destroy:function(){this.elem.parentNode.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(t,e){return void 0!==e&&this.elem.setAttribute(t,e),this},anyAncestor:function(t){for(var e=this.elem;e;){if(t(new n(e)))return!0;e=e.parentNode}return!1},isVisible:function(){return!r(this.elem)}};var i=1;function s(t,e){if(e("closeButton",!0))return t.child("button").html(e("closeHtml","&#xD7;")).clazz("pico-close").clazz(e("closeClass","")).stylize(e("closeStyles",{borderRadius:"2px",border:0,padding:0,cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"})).attr("aria-label",e("close-label","Close"))}function l(t){return function(){return t().elem}}var a=e(),u=e();function h(t,e){function n(t,e){return(t.msMatchesSelector||t.webkitMatchesSelector||t.matches).call(t,e)}function o(t){return!(r(t)||n(t,":disabled")||t.hasAttribute("contenteditable"))&&(t.hasAttribute("tabindex")||n(t,"input,select,textarea,button,a[href],area[href],iframe"))}function i(t){for(var e=t.getElementsByTagName("*"),r=0;r<e.length;r++)if(o(e[r]))return e[r]}var s;t.beforeShow((function(){s=document.activeElement})),t.afterShow((function(){if(e()){var r=i(t.modalElem());r&&r.focus()}})),t.afterClose((function(){e()&&s&&s.focus(),s=null})),u.watch((function(r){if(e()&&t.isVisible()){var n=i(t.modalElem()),s=function(t){for(var e=t.getElementsByTagName("*"),r=e.length;r--;)if(o(e[r]))return e[r]}(t.modalElem());(r.shiftKey?n:s)===document.activeElement&&((r.shiftKey?s:n).focus(),r.preventDefault())}}))}return document.documentElement.addEventListener("keydown",(function(t){var e=t.which||t.keyCode;27===e?a.trigger():9===e&&u.trigger(t)})),function(r){("string"==typeof r||t(r))&&(r={content:r});var u=e(),c=e(),f=e(),p=e(),y=e();function g(t,e){var n=r[t];return"function"==typeof n&&(n=n(e)),void 0===n?e:n}var d,m,v=k.bind(window,"modal"),b=k.bind(window,"overlay"),x=k.bind(window,"close");function w(t){b().hide(),v().hide(),y.trigger(d,t)}function E(t){p.trigger(d,t)&&w(t)}function S(t){return function(){return t.apply(this,arguments),d}}function k(t,e){if(!m){var r=function(t,e){var r=t("width","auto");"number"==typeof r&&(r+="px");var o=t("modalId","pico-"+i++);return n.make(t("parent")).clazz("pico-content").clazz(t("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"38.1966%",maxHeight:"90%",boxSizing:"border-box",width:r,"-ms-transform":"translate(-50%,-38.1966%)","-moz-transform":"translate(-50%,-38.1966%)","-webkit-transform":"translate(-50%,-38.1966%)","-o-transform":"translate(-50%,-38.1966%)",transform:"translate(-50%,-38.1966%)"}).stylize(t("modalStyles",{overflow:"auto",backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(t("content")).attr("id",o).attr("role","dialog").attr("aria-labelledby",t("ariaLabelledBy")).attr("aria-describedby",t("ariaDescribedBy",o)).onClick((function(t){new n(t.target).anyAncestor((function(t){return/\bpico-close\b/.test(t.elem.className)}))&&e()}))}(g,E);m={modal:r,overlay:o(g,E),close:s(r,g)},u.trigger(d,e)}return m[t]}return h(d={modalElem:l(v),closeElem:l(x),overlayElem:l(b),buildDom:S(k.bind(null,null)),isVisible:function(){return!!(m&&v&&v().isVisible())},show:function(t){return c.trigger(d,t)&&(b().show(),x(),v().show(),f.trigger(d,t)),this},close:S(E),forceClose:S(w),destroy:function(){v().destroy(),b().destroy(),b=v=x=void 0},options:function(t){Object.keys(t).map((function(e){r[e]=t[e]}))},afterCreate:S(u.watch),beforeShow:S(c.watch),afterShow:S(f.watch),beforeClose:S(p.watch),afterClose:S(y.watch)},g.bind(null,"focus",!0)),function(t,e){var r,o=new n(document.body);t.beforeShow((function(){r=o.elem.style.overflow,e()&&o.stylize({overflow:"hidden"})})),t.afterClose((function(){o.stylize({overflow:r})}))}(d,g.bind(null,"bodyOverflow",!0)),a.watch((function(){g("escCloses",!0)&&d.isVisible()&&d.close()})),d}},t.exports?t.exports=r():e.picoModal=r()}));if("undefined"!=typeof L){var Et,St=[];L.Stam=L.LayerGroup.extend({initialize:function(t){var e,r=new ft(t),n=function(t){t.setStyle(o.default),e=null},o={default:{opacity:0,fillOpacity:0},highlight:{color:"red",opacity:1}};this.on("add",(function(){if(null!=this._map){var i,s=this._map,l=s.getZoom(),a=(r,l)=>{var a;if(i&&(Et.clearLayers(),i=!1),"Polygon"==(null===(a=r.geometry)||void 0===a?void 0:a.type)&&r.properties.count){l.on("mouseover",(function(){t.clusterMouseOver&&t.clusterMouseOver(r),function(t){e&&n(e),t.setStyle(o.highlight),e=t}(l)})),l.on("mouseout",(function(){n(l)})),l.on("click",(function(){if(t.clusterClick){var e=t.clusterClick(r);if(e)return l.bindPopup(e)}s.fitBounds(l.getBounds())})),l.setStyle(o.default);var u=l.getBounds(),h=(u._northEast.lat+u._southWest.lat)/2,c=(u._northEast.lng+u._southWest.lng)/2,f=L.circleMarker(L.latLng(h,c),{radius:127/3});f.bindTooltip(`<span>${r.properties.count}</span>`,{permanent:!0,direction:"center",className:"count"}),Et.addLayer(f)}else{l.on("popupopen",(function(){Lt(document.getElementsByClassName("leaflet-popup-content")[0],r)})),l.on("click",(function(){var e=!0;if(t.markerClick){var n=t.markerClick(r);n&&(e=!1,l.bindPopup(n))}e&&l.bindPopup("<h3>"+r.properties.name+"</h3>")})),l.on("mouseover",(function(){if(t.markerMouseOver)return t.markerMouseOver(r)}))}},u=function(e,r){return L.marker(r,{icon:"function"==typeof t.markerStyle?mt(t.markerStyle(e)):"string"==typeof t.markerStyle?mt(t.markerStyle):new L.Icon.Default})};s.on("layeradd",(function(){s.off("layeradd"),Et=L.layerGroup(),this.addLayer(Et);var e=s.getBounds();r.getLayerData(s.getZoom(),[e._northEast.lng,e._northEast.lat,e._southWest.lng,e._southWest.lat]).then(e=>{var r=L.geoJSON(e,{onEachFeature:a,pointToLayer:u,style:t.clusterStyle});St.push(r),this.addLayer(r)})})),s.on("moveend",(function(){l!=s.getZoom()&&(l=s.getZoom()),i=!0;var e=s.getBounds();r.getLayerData(s.getZoom(),[e._northEast.lng,e._northEast.lat,e._southWest.lng,e._southWest.lat]).then(e=>{var r=L.geoJSON(e,{onEachFeature:a,pointToLayer:u,style:t.clusterStyle});St.forEach(t=>{t.remove()}),St.push(r),this.addLayer(r)})}))}}))}}),L.stam=function(t){return new L.Stam(t)};var kt=".leaflet-tooltip.count {background-color: transparent;border: transparent;  box-shadow: none;  font-weight: bold;font-size: 20px;}",_t=document.head||document.getElementsByTagName("head")[0],Pt=document.createElement("style");_t.appendChild(Pt),Pt.type="text/css",Pt.styleSheet?Pt.styleSheet.cssText=kt:Pt.appendChild(document.createTextNode(kt))}if("undefined"!=typeof ol){kt='.ol-popup{position:absolute;min-width:180px;background-color:#fff;-webkit-filter:drop-shadow(0 1px 4px rgba(0, 0, 0, .2));filter:drop-shadow(0 1px 4px rgba(0, 0, 0, .2));padding:15px;border-radius:10px;border:1px solid #ccc;bottom:40px;left:-50px}.ol-popup:after,.ol-popup:before{top:100%;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none}.ol-popup:after{border-top-color:#fff;border-width:10px;left:48px;margin-left:-10px}.ol-popup:before{border-top-color:#ccc;border-width:11px;left:48px;margin-left:-11px}.ol-popup-closer{text-decoration:none;position:absolute;top:2px;right:8px}.ol-popup-closer:after{content:"✖"}',_t=document.head||document.getElementsByTagName("head")[0],Pt=document.createElement("style");_t.appendChild(Pt),Pt.type="text/css",Pt.styleSheet?Pt.styleSheet.cssText=kt:Pt.appendChild(document.createTextNode(kt));var It,Ot,Tt=[],At=function(t){Ot=t.map,ol.layer.Group.call(this,t),It=Ot.getView().getZoom().toFixed(0);var e=new ft(t);document.getElementById("popup")||document.writeln('<div id="popup" class="ol-popup">\n      <a href="#" id="popup-closer" class="ol-popup-closer"></a>\n      <div id="popup-content"></div>\n      </div>');var r=document.getElementById("popup"),n=document.getElementById("popup-content"),o=document.getElementById("popup-closer");o.onclick=function(){return i.setPosition(void 0),o.blur(),!1};var i=new ol.Overlay({element:r,autoPan:!0,offset:[0,-10]});Ot.addOverlay(i),Ot.on("pointermove",(function(t){var e=this.forEachFeatureAtPixel(t.pixel,(function(t){return"cluster"!=t.get("name")}));this.getTargetElement().style.cursor=e?"pointer":""}));var s=null,l=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.7)"}),stroke:new ol.style.Stroke({color:"#3399CC",width:3})});Ot.on("pointermove",(function(t){null!==s&&(s.setStyle(void 0),s=null),Ot.forEachFeatureAtPixel(t.pixel,(function(t){if(t.get("count"))return s=t,t.setStyle(l),!0}))})),Ot.on("click",(function(e){var r=Ot.forEachFeatureAtPixel(e.pixel,(function(t,e){return t}));if(r)if(null!=r.get("@iot.id")){var o,s=r.getGeometry().getCoordinates();"function"==typeof t.markerClick&&(o=t.markerClick(Rt(r))),o?n.innerHTML=o:Lt(n,Rt(r)),i.setPosition(s)}else null!=r.get("count")&&("function"==typeof t.clusterClick?null==t||t.clusterClick(Rt(r)):Ot.getView().fit(r.getGeometry().getExtent(),Ot.getSize(),{duration:1e3}))})),Ot.on("moveend",(function(){It!=Ot.getView().getZoom()&&(It=Ot.getView().getZoom().toFixed(0)),function(t,e,r){return new Promise((function(n,o){var i;if("EPSG:4326"==Ot.getView().getProjection().getCode())i=Ot.getView().calculateExtent();else{var s=Ot.getView().calculateExtent(),l=Ot.getView().getProjection().getCode();(i=[]).push(...new ol.geom.Point([s[2],s[3]]).transform(l,"EPSG:4326").getCoordinates()),i.push(...new ol.geom.Point([s[0],s[1]]).transform(l,"EPSG:4326").getCoordinates())}t.getLayerData(e,i).then(t=>{var e=new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(t,{featureProjection:Ot.getView().getProjection().getCode()})}),o=new ol.source.Vector,i=new ol.layer.Vector({source:o}),s=new ol.layer.Vector({source:e,style:function(t){if("Point"==t.getGeometry().getType())return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],scale:.5,anchorXUnits:"fraction",anchorYUnits:"fraction",src:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${"function"==typeof r.markerStyle?r.markerStyle(Rt(t)):r.markerStyle?r.markerStyle:"blue"}.png`})});if(null!=t.get("count")){var e=t.getGeometry().getExtent(),n=(e[0]+e[2])/2,i=(e[1]+e[3])/2,s=new ol.Feature({geometry:new ol.geom.Circle([n,i],(e[2]-e[0])/6),name:"cluster"});return s.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({width:2,color:"red",radius:1}),text:new ol.style.Text({font:"30px Calibri,sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),text:""+t.get("count")})})),o.addFeature(s),new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:3}),fill:new ol.style.Fill({color:"rgba(0, 0, 0, 0)"})})}}});n(new ol.layer.Group({layers:[s,i]}))})}))}(e,It,t).then(function(t){this.getLayers().array_.push(t),this.changed(),this.getLayers().array_=this.getLayers().array_.filter(function(t){return-1==Tt.indexOf(t)}.bind(this)),t.on("change",()=>{Ot.render()}),Ot.render(),(Tt=[]).push(t)}.bind(this))}))};bt=At,xt=ol.layer.Group,bt.prototype=Object.create(xt.prototype),bt.prototype.constructor=bt,ol.layer.STAM=At}function Lt(e,r){e.innerHTML="<h3>"+r.properties.name+"</h3>";var n=document.createElement("ul");Object.keys(r.properties.getData).forEach(e=>{var o=document.createElement("li");o.innerText=e,o.setAttribute("style","cursor: pointer"),o.onclick=function(){wt({width:1140,content:"",modalId:"pico-1"}).beforeClose((function(){Plotly.purge("pico-1"),document.getElementById("pico-1").remove()})).afterShow((function(){return t(this,void 0,void 0,(function*(){var t=yield r.properties.getData[e](),n=[],o=[];t.value.forEach(t=>{t.dataArray.forEach(t=>{-1!=t[1].indexOf("/")?n.push(t[1].split("/")[0]):n.push(t[1]),o.push(t[2])})});var i=[{x:n,y:o,type:"scatter"}],s={height:300,xaxis:{autorange:!0},yaxis:{autorange:!0,title:{text:t.unitOfMeasurement.name}},autosize:!0};Plotly.newPlot("pico-1",i,s)}))})).show()},n.appendChild(o)}),e.appendChild(n)}function Rt(t){return{type:t.getGeometry().getType(),properties:t.getProperties(),geometry:{type:"Point",coordinates:t.getGeometry().getCoordinates()}}}}();
