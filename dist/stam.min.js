!function(){"use strict";function l(t,s,a,u){return new(a=a||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,o)}i((u=u.apply(t,s||[])).next())})}function f(r,n){var o,i,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,i=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(r,a)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var e,r,a="undefined"!=typeof self?self:void 0,n="URLSearchParams"in a,o="Symbol"in a&&"iterator"in Symbol,u="FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in a,h="ArrayBuffer"in a;function s(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function c(t){return"string"!=typeof t&&(t=String(t)),t}function t(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(r){return new Promise(function(t,e){r.onload=function(){t(r.result)},r.onerror=function(){e(r.error)}})}function b(t){var e=new FileReader,r=d(e);return e.readAsArrayBuffer(t),r}function m(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(t){var e;this.bodyUsed=this.bodyUsed,(this._bodyInit=t)?"string"==typeof t?this._bodyText=t:u&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:i&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():h&&u&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=m(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):h&&(ArrayBuffer.prototype.isPrototypeOf(t)||r(t))?this._bodyArrayBuffer=m(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var t,e,r,n=y(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,r=d(e),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}h&&(e=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=ArrayBuffer.isView||function(t){return t&&-1<e.indexOf(Object.prototype.toString.call(t))}),p.prototype.append=function(t,e){t=s(t),e=c(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},p.prototype.delete=function(t){delete this.map[s(t)]},p.prototype.get=function(t){return t=s(t),this.has(t)?this.map[t]:null},p.prototype.has=function(t){return this.map.hasOwnProperty(s(t))},p.prototype.set=function(t,e){this.map[s(t)]=c(e)},p.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},p.prototype.keys=function(){var r=[];return this.forEach(function(t,e){r.push(e)}),t(r)},p.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),t(e)},p.prototype.entries=function(){var r=[];return this.forEach(function(t,e){r.push([e,t])}),t(r)},o&&(p.prototype[Symbol.iterator]=p.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function g(t,e){var r,n,o,i=(e=e||{}).body;if(t instanceof g){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new p(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new p(e.headers)),this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),-1<v.indexOf(n)?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i),"GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache||((o=/([?&])_=[^&]*/).test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime())}function T(t){var o=new FormData;return t.trim().split("&").forEach(function(t){var e,r,n;t&&(r=(e=t.split("=")).shift().replace(/\+/g," "),n=e.join("=").replace(/\+/g," "),o.append(decodeURIComponent(r),decodeURIComponent(n)))}),o}function _(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"",this.headers=new p(e.headers),this.url=e.url||"",this._initBody(t)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},w.call(g.prototype),w.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},_.error=function(){var t=new _(null,{status:0,statusText:""});return t.type="error",t};var x=[301,302,303,307,308];_.redirect=function(t,e){if(-1===x.indexOf(e))throw new RangeError("Invalid status code");return new _(null,{status:e,headers:{location:t}})};var A=a.DOMException;function E(o,s){return new Promise(function(n,t){var e=new g(o,s);if(e.signal&&e.signal.aborted)return t(new A("Aborted","AbortError"));var i=new XMLHttpRequest;function r(){i.abort()}i.onload=function(){var t,o,e={status:i.status,statusText:i.statusText,headers:(t=i.getAllResponseHeaders()||"",o=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e,r=t.split(":"),n=r.shift().trim();n&&(e=r.join(":").trim(),o.append(n,e))}),o)};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var r="response"in i?i.response:i.responseText;setTimeout(function(){n(new _(r,e))},0)},i.onerror=function(){setTimeout(function(){t(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){t(new TypeError("Network request failed"))},0)},i.onabort=function(){setTimeout(function(){t(new A("Aborted","AbortError"))},0)},i.open(e.method,function(e){try{return""===e&&a.location.href?a.location.href:e}catch(t){return e}}(e.url),!0),"include"===e.credentials?i.withCredentials=!0:"omit"===e.credentials&&(i.withCredentials=!1),"responseType"in i&&(u?i.responseType="blob":h&&e.headers.get("Content-Type")&&-1!==e.headers.get("Content-Type").indexOf("application/octet-stream")&&(i.responseType="arraybuffer")),e.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),e.signal&&(e.signal.addEventListener("abort",r),i.onreadystatechange=function(){4===i.readyState&&e.signal.removeEventListener("abort",r)}),i.send(void 0===e._bodyInit?null:e._bodyInit)})}"function"!=typeof A&&((A=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack}).prototype=Object.create(Error.prototype),A.prototype.constructor=A),E.polyfill=!0,a.fetch||(a.fetch=E,a.Headers=p,a.Request=g,a.Response=_);var O=(j.prototype.toString=function(t){void 0===t&&(t=!0);var e=this.queryObject.entityType,r=[];for(var n in this.queryObject)this.queryObject[n]&&("select"!=n?"expand"!=n?"entityType"!=n&&r.push("$"+n+"="+this.queryObject[n].toString()):r.push("$expand="+this.queryObject.expand.map(function(t){return new j(t).toString(!1)}).join(",")):r.push("$select="+this.queryObject.select.join(",")));return 0==r.length?e:t?e+"?"+r.map(encodeURI).join("&"):e+"("+r.map(encodeURI).join(",")+")"},j);function j(t){this.queryObject=t}var B=(U.prototype.getGeoJson=function(t,h){var c=this;return new Promise(function(t,e){var r,n,o,i,s,a=c.queryObject;a.select=["id"],a.expand=[{entityType:"Locations"}],"Things"==c.queryObject.entityType&&(r=h[1],n=h[0],o=h[3],s="geo.intersects(Locations/location,geography'POLYGON (("+r+" "+n+", "+r+" "+(i=h[2])+", "+o+" "+n+", "+o+" "+i+","+r+" "+n+"))')",a.filter?a.filter="("+a.filter+") and "+s:a.filter=s);var u=c.baseUrl+"/"+new O(c.queryObject).toString();fetch(u).then(function(o){return l(c,void 0,void 0,function(){var e,r,n;return f(this,function(t){switch(t.label){case 0:return[4,o.json()];case 1:o=t.sent(),e=o["@iot.nextLink"],t.label=2;case 2:return e?[4,fetch(e)]:[3,5];case 3:return[4,t.sent().json()];case 4:return r=t.sent(),(n=o.value).push.apply(n,r.value),console.log(r),e=r["@iot.nextLink"],[3,2];case 5:return[2]}})})})})},U);function U(t,e){this.queryObject=t,this.baseUrl=e}var P=(S.prototype.getLayerData=function(r,n){return l(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.api.getGeoJson(r,n)];case 1:return e=t.sent(),console.log(e),[2]}})})},S);function S(t){this.config=t,this.api=new B(t.queryObject,t.baseUrl)}void 0!==L&&(L.Stam=L.LayerGroup.extend({initialize:function(t){var n=new P(t);this.on("add",function(){var e,r;null!=this._map&&((e=this._map).on("layeradd",function(){e.off("layeradd");var t=e.getBounds();n.getLayerData(1,[t._northEast.lat,t._northEast.lng,t._southWest.lat,t._southWest.lng]).then(function(t){}),this.addLayer(L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}))}),r=e.getZoom(),e.on("moveend",function(t){e.getZoom()!=r&&(r=e.getZoom(),console.log(e.getZoom()))}))})}}),L.stam=function(){return new L.Stam({baseUrl:"https://airquality-frost.docker01.ilt-dmz.iosb.fraunhofer.de/v1.1",queryObject:{count:!0,skip:0,entityType:"Things",filter:null,select:null,expand:null,top:0}})})}();
