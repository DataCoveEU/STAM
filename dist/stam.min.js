!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function t(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function l(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,l)}a((r=r.apply(t,e||[])).next())}))}var e="undefined"!=typeof self?self:void 0,n="URLSearchParams"in e,r="Symbol"in e&&"iterator"in Symbol,i="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in e,s="ArrayBuffer"in e;if(s)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(t){return t&&l.indexOf(Object.prototype.toString.call(t))>-1};function u(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function h(t){return"string"!=typeof t&&(t=String(t)),t}function c(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return r&&(e[Symbol.iterator]=function(){return e}),e}function f(t){this.map={},t instanceof f?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function p(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function y(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function d(t){var e=new FileReader,n=y(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(t){var e;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:i&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:o&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&i&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||a(t))?this._bodyArrayBuffer=g(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(d)}),this.text=function(){var t,e,n,r=p(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=y(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(t,e){t=u(t),e=h(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},f.prototype.delete=function(t){delete this.map[u(t)]},f.prototype.get=function(t){return t=u(t),this.has(t)?this.map[t]:null},f.prototype.has=function(t){return this.map.hasOwnProperty(u(t))},f.prototype.set=function(t,e){this.map[u(t)]=h(e)},f.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},f.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),c(t)},f.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),c(t)},f.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),c(t)},r&&(f.prototype[Symbol.iterator]=f.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(t,e){var n,r,i=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new f(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new f(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),v.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache)){var o=/([?&])_=[^&]*/;if(o.test(this.url))this.url=this.url.replace(o,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function w(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}})),e}function x(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"",this.headers=new f(e.headers),this.url=e.url||"",this._initBody(t)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},m.call(b.prototype),m.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},x.error=function(){var t=new x(null,{status:0,statusText:""});return t.type="error",t};var E=[301,302,303,307,308];x.redirect=function(t,e){if(-1===E.indexOf(e))throw new RangeError("Invalid status code");return new x(null,{status:e,headers:{location:t}})};var S=e.DOMException;function k(t,n){return new Promise((function(r,o){var l=new b(t,n);if(l.signal&&l.signal.aborted)return o(new S("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var t,e,n={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new f,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}})),e)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;setTimeout((function(){r(new x(i,n))}),0)},a.onerror=function(){setTimeout((function(){o(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){o(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){o(new S("Aborted","AbortError"))}),0)},a.open(l.method,function(t){try{return""===t&&e.location.href?e.location.href:t}catch(e){return t}}(l.url),!0),"include"===l.credentials?a.withCredentials=!0:"omit"===l.credentials&&(a.withCredentials=!1),"responseType"in a&&(i?a.responseType="blob":s&&l.headers.get("Content-Type")&&-1!==l.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),l.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),l.signal&&(l.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&l.signal.removeEventListener("abort",u)}),a.send(void 0===l._bodyInit?null:l._bodyInit)}))}"function"!=typeof S&&((S=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack}).prototype=Object.create(Error.prototype),S.prototype.constructor=S),k.polyfill=!0,e.fetch||(e.fetch=k,e.Headers=f,e.Request=b,e.Response=x);class _{constructor(t){this.queryObject=t}toString(t=!0){var e=this.queryObject.entityType,n=[];if(this.queryObject.id){if(!t)return`${this.queryObject.entityType}(${this.queryObject.id})`;e=`${e}(${this.queryObject.id})`,delete this.queryObject.id}for(var r in this.queryObject.pathSuffix&&(e=`${e}/${this.queryObject.pathSuffix}`),this.queryObject)(this.queryObject[r]||0==this.queryObject[r])&&("select"!=r?"expand"!=r?"entityType"!=r&&"pathSuffix"!=r&&n.push(`$${r}=${this.queryObject[r].toString()}`):n.push("$expand="+this.queryObject.expand.map(t=>new _(t).toString(!1)).join(",")):n.push("$select="+this.queryObject.select.join(",")));return 0==n.length?e:t?`${e}?${n.join("&")}`:`${e}(${n.join(";")})`}}class T{constructor(t){this.baseUrl=t}getGeoJson(e){var n=e.top;return null!=e.top&&null!=e.top||(e.top=1e4),(e=JSON.parse(JSON.stringify(e))).count=!0,new Promise((r,i)=>t(this,void 0,void 0,(function*(){var t=`${this.baseUrl}/${new _(e).toString()}`,i=yield(yield fetch(t)).json();i.value[0]&&i.value[0].dataArray&&(i.value=i.value[0]);for(var o=i["@iot.nextLink"];o&&(null==n||i.value.length&&i.value.length<n||i.value.dataArray&&i.value.dataArray.length<n);){var s=yield(yield fetch(o)).json();s.value[0]&&s.value[0].dataArray?i.value.dataArray.push(...s.value[0].dataArray):i.value.push(...s.value),o=s["@iot.nextLink"]}console.log(i),r(i)})))}}var I="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function P(){throw new Error("setTimeout has not been defined")}function O(){throw new Error("clearTimeout has not been defined")}var A=P,C=O;function R(t){if(A===setTimeout)return setTimeout(t,0);if((A===P||!A)&&setTimeout)return A=setTimeout,setTimeout(t,0);try{return A(t,0)}catch(e){try{return A.call(null,t,0)}catch(e){return A.call(this,t,0)}}}"function"==typeof I.setTimeout&&(A=setTimeout),"function"==typeof I.clearTimeout&&(C=clearTimeout);var M,z=[],N=!1,B=-1;function j(){N&&M&&(N=!1,M.length?z=M.concat(z):B=-1,z.length&&D())}function D(){if(!N){var t=R(j);N=!0;for(var e=z.length;e;){for(M=z,z=[];++B<e;)M&&M[B].run();B=-1,e=z.length}M=null,N=!1,function(t){if(C===clearTimeout)return clearTimeout(t);if((C===O||!C)&&clearTimeout)return C=clearTimeout,clearTimeout(t);try{C(t)}catch(e){try{return C.call(null,t)}catch(e){return C.call(this,t)}}}(t)}}function U(t,e){this.fun=t,this.array=e}U.prototype.run=function(){this.fun.apply(null,this.array)};function $(){}var G=$,F=$,q=$,V=$,J=$,H=$,Y=$;var Z=I.performance||{},W=Z.now||Z.mozNow||Z.msNow||Z.oNow||Z.webkitNow||function(){return(new Date).getTime()};var Q=new Date;var X={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];z.push(new U(t,e)),1!==z.length||N||R(D)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:G,addListener:F,once:q,off:V,removeListener:J,removeAllListeners:H,emit:Y,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*W.call(Z),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Q)/1e3}};
/**
     * splaytree v3.0.1
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */class K{constructor(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}}function tt(t,e){return t>e?1:t<e?-1:0}function et(t,e,n){const r=new K(null,null);let i=r,o=r;for(;;){const r=n(t,e.key);if(r<0){if(null===e.left)break;if(n(t,e.left.key)<0){const t=e.left;if(e.left=t.right,t.right=e,null===(e=t).left)break}o.left=e,o=e,e=e.left}else{if(!(r>0))break;if(null===e.right)break;if(n(t,e.right.key)>0){const t=e.right;if(e.right=t.left,t.left=e,null===(e=t).right)break}i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function nt(t,e,n,r){const i=new K(t,e);if(null===n)return i.left=i.right=null,i;const o=r(t,(n=et(t,n,r)).key);return o<0?(i.left=n.left,i.right=n,n.left=null):o>=0&&(i.right=n.right,i.left=n,n.right=null),i}function rt(t,e,n){let r=null,i=null;if(e){const o=n((e=et(t,e,n)).key,t);0===o?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}class it{constructor(t=tt){this._root=null,this._size=0,this._comparator=t}insert(t,e){return this._size++,this._root=nt(t,e,this._root,this._comparator)}add(t,e){const n=new K(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);const r=this._comparator,i=et(t,this._root,r),o=r(t,i.key);return 0===o?this._root=i:(o<0?(n.left=i.left,n.right=i,i.left=null):o>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root}remove(t){this._root=this._remove(t,this._root,this._comparator)}_remove(t,e,n){let r;if(null===e)return null;return 0===n(t,(e=et(t,e,n)).key)?(null===e.left?r=e.right:(r=et(t,e.left,n),r.right=e.right),this._size--,r):e}pop(){let t=this._root;if(t){for(;t.left;)t=t.left;return this._root=et(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null}findStatic(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}find(t){return this._root&&(this._root=et(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}contains(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}forEach(t,e){let n=this._root;const r=[];let i=!1;for(;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}range(t,e,n,r){const i=[],o=this._comparator;let s,l=this._root;for(;0!==i.length||l;)if(l)i.push(l),l=l.left;else{if(l=i.pop(),s=o(l.key,e),s>0)break;if(o(l.key,t)>=0&&n.call(r,l))return this;l=l.right}return this}keys(){const t=[];return this.forEach(({key:e})=>t.push(e)),t}values(){const t=[];return this.forEach(({data:e})=>t.push(e)),t}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}at(t){let e=this._root,n=!1,r=0;const i=[];for(;!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}next(t){let e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}prev(t){let e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}clear(){return this._root=null,this._size=0,this}toList(){return function(t){let e=t;const n=[];let r=!1;const i=new K(null,null);let o=i;for(;!r;)e?(n.push(e),e=e.left):n.length>0?(e=o=o.next=n.pop(),e=e.right):r=!0;return o.next=null,i.next}(this._root)}load(t,e=[],n=!1){let r=t.length;const i=this._comparator;if(n&&function t(e,n,r,i,o){if(r>=i)return;const s=e[r+i>>1];let l=r-1,a=i+1;for(;;){do{l++}while(o(e[l],s)<0);do{a--}while(o(e[a],s)>0);if(l>=a)break;let t=e[l];e[l]=e[a],e[a]=t,t=n[l],n[l]=n[a],n[a]=t}t(e,n,r,a,o),t(e,n,a+1,i,o)}(t,e,0,r-1,i),null===this._root)this._root=function t(e,n,r,i){const o=i-r;if(o>0){const s=r+Math.floor(o/2),l=e[s],a=n[s],u=new K(l,a);return u.left=t(e,n,r,s),u.right=t(e,n,s+1,i),u}return null}(t,e,0,r),this._size=r;else{const n=function(t,e,n){const r=new K(null,null);let i=r,o=t,s=e;for(;null!==o&&null!==s;)n(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;null!==o?i.next=o:null!==s&&(i.next=s);return r.next}(this.toList(),function(t,e){const n=new K(null,null);let r=n;for(let n=0;n<t.length;n++)r=r.next=new K(t[n],e[n]);return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=function t(e,n,r){const i=r-n;if(i>0){const o=n+Math.floor(i/2),s=t(e,n,o),l=e.head;return l.left=s,e.head=e.head.next,l.right=t(e,o+1,r),l}return null}({head:n},0,r)}return this}isEmpty(){return null===this._root}get size(){return this._size}get root(){return this._root}toString(t=(t=>String(t.key))){const e=[];return function t(e,n,r,i,o){if(e){i(`${n}${r?"└── ":"├── "}${o(e)}\n`);const s=n+(r?"    ":"│   ");e.left&&t(e.left,s,!1,i,o),e.right&&t(e.right,s,!0,i,o)}}(this._root,"",!0,t=>e.push(t),t),e.join("")}update(t,e,n){const r=this._comparator;let{left:i,right:o}=rt(t,this._root,r);r(t,e)<0?o=nt(e,n,o,r):i=nt(e,n,i,r),this._root=function(t,e,n){return null===e?t:(null===t||((e=et(t.key,e,n)).left=t),e)}(i,o,r)}split(t){return rt(t,this._root,this._comparator)}}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lt(t,e,n){return e&&st(t.prototype,e),n&&st(t,n),t}var at=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},ut=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},ht=Number.EPSILON;void 0===ht&&(ht=Math.pow(2,-52));var ct=ht*ht,ft=function(t,e){if(-ht<t&&t<ht&&-ht<e&&e<ht)return 0;var n=t-e;return n*n<ct*t*e?0:t<e?-1:1},pt=function(){function t(){ot(this,t),this.reset()}return lt(t,[{key:"reset",value:function(){this.xRounder=new yt,this.yRounder=new yt}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),yt=function(){function t(){ot(this,t),this.tree=new it,this.round(0)}return lt(t,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===ft(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===ft(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),t}(),dt=new pt,gt=function(t,e){return t.x*e.y-t.y*e.x},mt=function(t,e){return t.x*e.x+t.y*e.y},vt=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=gt(r,i);return ft(o,0)},bt=function(t){return Math.sqrt(mt(t,t))},wt=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return mt(i,r)/bt(i)/bt(r)},xt=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},Et=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},St=function(){function t(e,n){ot(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return lt(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:_t.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),lt(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&(n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,s,l,a,u=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,s=u.point,l={x:o.x-i.x,y:o.y-i.y},a={x:s.x-i.x,y:s.y-i.y},gt(a,l)/bt(a)/bt(l)),cosine:wt(e.point,t.point,u.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,s=i.cosine,l=n.get(e),a=l.sine,u=l.cosine;return o>=0&&a>=0?s<u?1:s>u?-1:0:o<0&&a<0?s<u?-1:s>u?1:0:a<o?-1:a>o?1:0}}}]),t}(),kt=0,_t=function(){function t(e,n,r,i){ot(this,t),this.id=++kt,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return lt(t,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var s=t.leftSE.point.y,l=e.leftSE.point.y,a=t.rightSE.point.y,u=e.rightSE.point.y;if(n<r){if(l<s&&l<a)return 1;if(l>s&&l>a)return-1;var h=t.comparePoint(e.leftSE.point);if(h<0)return 1;if(h>0)return-1;var c=e.comparePoint(t.rightSE.point);return 0!==c?c:-1}if(n>r){if(s<l&&s<u)return-1;if(s>l&&s>u)return 1;var f=e.comparePoint(t.leftSE.point);if(0!==f)return f;var p=t.comparePoint(e.rightSE.point);return p<0?1:p>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(i<o){var y=e.comparePoint(t.rightSE.point);if(0!==y)return y}if(i>o){var d=t.comparePoint(e.rightSE.point);if(d<0)return 1;if(d>0)return-1}if(i!==o){var g=a-s,m=i-n,v=u-l,b=o-r;if(g>m&&v<b)return 1;if(g<m&&v>b)return-1}return i>o?1:i<o||a<u?-1:a>u?1:t.id<e.id?-1:t.id>e.id?1:0}}]),lt(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var s=(t.x-e.x)/r.x,l=e.y+s*r.y;return t.y===l?0:t.y<l?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=ut(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,l=t.rightSE.point,a=at(e,s)&&0===this.comparePoint(s),u=at(n,i)&&0===t.comparePoint(i),h=at(e,l)&&0===this.comparePoint(l),c=at(n,o)&&0===t.comparePoint(o);if(u&&a)return c&&!h?o:!c&&h?l:null;if(u)return h&&i.x===l.x&&i.y===l.y?null:i;if(a)return c&&o.x===s.x&&o.y===s.y?null:s;if(c&&h)return null;if(c)return o;if(h)return l;var f=function(t,e,n,r){if(0===e.x)return Et(n,r,t.x);if(0===r.x)return Et(t,e,n.x);if(0===e.y)return xt(n,r,t.y);if(0===r.y)return xt(t,e,n.y);var i=gt(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},s=gt(o,e)/i,l=gt(o,r)/i;return{x:(t.x+l*e.x+(n.x+s*r.x))/2,y:(t.y+l*e.y+(n.y+s*r.y))/2}}(i,this.vector(),s,t.vector());return null===f?null:at(r,f)?dt.round(f.x,f.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new St(e,!0),o=new St(e,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var l=new t(i,s,this.rings.slice(),this.windings.slice());return St.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),St.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var s=n;n=r,r=s}for(var l=0,a=r.rings.length;l<a;l++){var u=r.rings[l],h=r.windings[l],c=n.rings.indexOf(u);-1===c?(n.rings.push(u),n.windings.push(h)):n.windings[c]+=h}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],l=this.windings[i],a=e.indexOf(s);-1===a?(e.push(s),n.push(l)):n[a]+=l}for(var u=[],h=[],c=0,f=e.length;c<f;c++)if(0!==n[c]){var p=e[c],y=p.poly;if(-1===h.indexOf(y))if(p.isExterior)u.push(y);else{-1===h.indexOf(y)&&h.push(y);var d=u.indexOf(p.poly);-1!==d&&u.splice(d,1)}}for(var g=0,m=u.length;g<m;g++){var v=u[g].multiPoly;-1===r.indexOf(v)&&r.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(zt.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===zt.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var l=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=l(t)!==l(e);break;default:throw new Error("Unrecognized operation type found ".concat(zt.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,s,l=St.comparePoints(e,n);if(l<0)i=e,o=n,s=1;else{if(!(l>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,s=-1}return new t(new St(i,!0),new St(o,!1),[r],[s])}}]),t}(),Tt=function(){function t(e,n,r){if(ot(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=dt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,l=e.length;s<l;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=dt.round(e[s][0],e[s][1]);a.x===o.x&&a.y===o.y||(this.segments.push(_t.fromRing(o,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),o=a)}i.x===o.x&&i.y===o.y||this.segments.push(_t.fromRing(o,i,this))}return lt(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),t}(),Lt=function(){function t(e,n){if(ot(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Tt(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new Tt(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return lt(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),It=function(){function t(e,n){if(ot(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new Lt(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return lt(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),Pt=function(){function t(e){ot(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return lt(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var s=null,l=o.leftSE,a=o.rightSE,u=[l],h=l.point,c=[];s=l,l=a,u.push(l),l.point!==h;)for(;;){var f=l.getAvailableLinkedEvents();if(0===f.length){var p=u[0].point,y=u[u.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(y.x,", ").concat(y.y,"]."))}if(1===f.length){a=f[0].otherSE;break}for(var d=null,g=0,m=c.length;g<m;g++)if(c[g].point===l.point){d=g;break}if(null===d){c.push({index:u.length,point:l.point});var v=l.getLeftmostComparator(s);a=f.sort(v)[0].otherSE;break}var b=c.splice(d)[0],w=u.splice(b.index);w.unshift(w[0].otherSE),n.push(new t(w.reverse()))}n.push(new t(u))}}return n}}]),lt(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==vt(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var s=e[0],l=e[1];0===vt(s,t,l)&&e.shift(),e.push(e[0]);for(var a=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:e.length-1,h=this.isExteriorRing()?e.length:-1,c=[],f=u;f!=h;f+=a)c.push([e[f].x,e[f].y]);return c}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];St.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),Ot=function(){function t(e){ot(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return lt(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}(),At=function(){function t(e){ot(this,t),this.rings=e,this.polys=this._composePolys(e)}return lt(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new Ot(i));else{var o=i.enclosingRing();o.poly||e.push(new Ot(o)),o.poly.addInterior(i)}}return e}}]),t}(),Ct=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_t.compare;ot(this,t),this.queue=e,this.tree=new it(n),this.segments=[]}return lt(t,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,s=void 0,l=void 0;void 0===s;)null===(i=this.tree.prev(i))?s=null:void 0===i.key.consumedBy&&(s=i.key);for(;void 0===l;)null===(o=this.tree.next(o))?l=null:void 0===o.key.consumedBy&&(l=o.key);if(t.isLeft){var a=null;if(s){var u=s.getIntersection(e);if(null!==u&&(e.isAnEndpoint(u)||(a=u),!s.isAnEndpoint(u)))for(var h=this._splitSafely(s,u),c=0,f=h.length;c<f;c++)n.push(h[c])}var p=null;if(l){var y=l.getIntersection(e);if(null!==y&&(e.isAnEndpoint(y)||(p=y),!l.isAnEndpoint(y)))for(var d=this._splitSafely(l,y),g=0,m=d.length;g<m;g++)n.push(d[g])}if(null!==a||null!==p){var v=null;if(null===a)v=p;else if(null===p)v=a;else{v=St.comparePoints(a,p)<=0?a:p}this.queue.remove(e.rightSE),n.push(e.rightSE);for(var b=e.split(v),w=0,x=b.length;w<x;w++)n.push(b[w])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&l){var E=s.getIntersection(l);if(null!==E){if(!s.isAnEndpoint(E))for(var S=this._splitSafely(s,E),k=0,_=S.length;k<_;k++)n.push(S[k]);if(!l.isAnEndpoint(E))for(var T=this._splitSafely(l,E),L=0,I=T.length;L<I;L++)n.push(T[L])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),t}(),Rt=void 0!==X&&X.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Mt=void 0!==X&&X.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,zt=new(function(){function t(){ot(this,t)}return lt(t,[{key:"run",value:function(t,e,n){zt.type=t,dt.reset();for(var r=[new It(e,!0)],i=0,o=n.length;i<o;i++)r.push(new It(n[i],!1));if(zt.numMultiPolys=r.length,"difference"===zt.type)for(var s=r[0],l=1;l<r.length;)null!==ut(r[l].bbox,s.bbox)?l++:r.splice(l,1);if("intersection"===zt.type)for(var a=0,u=r.length;a<u;a++)for(var h=r[a],c=a+1,f=r.length;c<f;c++)if(null===ut(h.bbox,r[c].bbox))return[];for(var p=new it(St.compare),y=0,d=r.length;y<d;y++)for(var g=r[y].getSweepEvents(),m=0,v=g.length;m<v;m++)if(p.insert(g[m]),p.size>Rt)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new Ct(p),w=p.size,x=p.pop();x;){var E=x.key;if(p.size===w){var S=E.segment;throw new Error("Unable to pop() ".concat(E.isLeft?"left":"right"," SweepEvent ")+"[".concat(E.point.x,", ").concat(E.point.y,"] from segment #").concat(S.id," ")+"[".concat(S.leftSE.point.x,", ").concat(S.leftSE.point.y,"] -> ")+"[".concat(S.rightSE.point.x,", ").concat(S.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(p.size>Rt)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>Mt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var k=b.process(E),_=0,T=k.length;_<T;_++){var L=k[_];void 0===L.consumedBy&&p.insert(L)}w=p.size,x=p.pop()}dt.reset();var I=Pt.factory(b.segments);return new At(I).getGeom()}}]),t}());function Nt(){}function Bt(){Bt.init.call(this)}function jt(t){return void 0===t._maxListeners?Bt.defaultMaxListeners:t._maxListeners}function Dt(t,e,n){if(e)t.call(n);else for(var r=t.length,i=Ht(t,r),o=0;o<r;++o)i[o].call(n)}function Ut(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=Ht(t,i),s=0;s<i;++s)o[s].call(n,r)}function $t(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=Ht(t,o),l=0;l<o;++l)s[l].call(n,r,i)}function Gt(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,l=Ht(t,s),a=0;a<s;++a)l[a].call(n,r,i,o)}function Ft(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=Ht(t,i),s=0;s<i;++s)o[s].apply(n,r)}function qt(t,e,n,r){var i,o,s,l;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=new Nt,t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=jt(t))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,l=a,"function"==typeof console.warn?console.warn(l):console.log(l)}}else s=o[e]=n,++t._eventsCount;return t}function Vt(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}function Jt(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Ht(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}Nt.prototype=Object.create(null),Bt.EventEmitter=Bt,Bt.usingDomains=!1,Bt.prototype.domain=void 0,Bt.prototype._events=void 0,Bt.prototype._maxListeners=void 0,Bt.defaultMaxListeners=10,Bt.init=function(){this.domain=null,Bt.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Nt,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Bt.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},Bt.prototype.getMaxListeners=function(){return jt(this)},Bt.prototype.emit=function(t){var e,n,r,i,o,s,l,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(l=this.domain,a){if(e=arguments[1],!l){if(e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=l,e.domainThrown=!1,l.emit("error",e),!1}if(!(n=s[t]))return!1;var h="function"==typeof n;switch(r=arguments.length){case 1:Dt(n,h,this);break;case 2:Ut(n,h,this,arguments[1]);break;case 3:$t(n,h,this,arguments[1],arguments[2]);break;case 4:Gt(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];Ft(n,h,this,i)}return!0},Bt.prototype.addListener=function(t,e){return qt(this,t,e,!1)},Bt.prototype.on=Bt.prototype.addListener,Bt.prototype.prependListener=function(t,e){return qt(this,t,e,!0)},Bt.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,Vt(this,t,e)),this},Bt.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,Vt(this,t,e)),this},Bt.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new Nt:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Nt,this;delete r[t]}else!function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,i);r.removeListener&&this.emit("removeListener",t,s||e)}return this},Bt.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Nt,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new Nt:delete n[t]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Nt,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},Bt.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},Bt.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):Jt.call(t,e)},Bt.prototype.listenerCount=Jt,Bt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class Yt extends Bt{constructor(t){super(),this.cache=[],this.config=t,this.api=new T(t.baseUrl)}long2tile(t,e){return Math.floor((t+180)/360*Math.pow(2,e))}lat2tile(t,e){return Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}tile2long(t,e){return t/Math.pow(2,e)*360-180}tile2lat(t,e){var n=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}coordinatesToOsm(t,e){return{lat:this.tile2long(this.long2tile(t.lat,e),e),lng:this.tile2lat(this.lat2tile(t.lng,e),e)}}coordinatesToOsmBottom(t,e){return{lat:this.tile2long(this.long2tile(t.lat,e)+1,e),lng:this.tile2lat(this.lat2tile(t.lng,e)+1,e)}}getOSMBoundingBox(t,e){var n={lat:0,lng:0},r={lat:0,lng:0},i=this.long2tile(e[0],t),o=this.lat2tile(e[1],t);n.lat=this.tile2long(i+1,t),n.lng=this.tile2lat(o,t);var s=this.long2tile(e[2],t),l=this.lat2tile(e[3],t);return r.lat=this.tile2long(s,t),r.lng=this.tile2lat(l+1,t),[n.lat,n.lng,r.lat,r.lng]}getQuery(t){if("entityType"in this.config.queryObject)return this.config.queryObject;var e=this.config.queryObject;for(var n of e)if(isNaN(Number(n.zoomLevel))){var r=n.zoomLevel;if(r.to){if(t>=r.from&&t<=r.to)return n.query}else if(t>=r.from)return n.query}else{if(n.zoomLevel==t)return n.query}throw new Error("No Query specified for the zoomLevel: "+t)}getLayerData(e,n){return t(this,void 0,void 0,(function*(){this.emitChange(e);var r=JSON.parse(JSON.stringify(this.getQuery(e)));if("Things"==r.entityType)r.select=["id"],r.expand=[{entityType:"Locations"}];else{if("FeaturesOfInterest"!=r.entityType)throw new Error("Only Things and FeaturesOfInterest are supported");r.select=["feature"]}if(this.config.cluster||null==this.config.cluster){r.count=!0,r.top=0;for(var i={lat:this.lat2tile(n[1],e),lng:this.long2tile(n[0],e)},o={lat:this.lat2tile(n[3],e),lng:this.long2tile(n[2],e)},s=[],l=[],a=o.lng;a<=i.lng;a++)for(var u=i.lat;u<=o.lat;u++){const n={lat:this.tile2lat(u,e),lng:this.tile2long(a,e)},i={lat:this.tile2lat(u+1,e),lng:this.tile2long(a+1,e)},o=JSON.parse(JSON.stringify(r)),s=Qt([[[n.lng,n.lat],[n.lng,i.lat],[i.lng,i.lat],[i.lng,n.lat],[n.lng,n.lat]]],o.entityType);o.filter?o.filter=`(${o.filter}) and ${s}`:o.filter=s;const h={type:"Feature",geometry:{type:"Polygon",coordinates:[[[n.lng,n.lat],[n.lng,i.lat],[i.lng,i.lat],[i.lng,n.lat],[n.lng,n.lat]]]},properties:{count:0}};this.getCached(e).features.find(t=>Zt(h,t))||l.push(new Promise((n,r)=>t(this,void 0,void 0,(function*(){var t=yield this.api.getGeoJson(o);h.properties.count=t["@iot.count"],this.addToCache(e,h),n(h)}))))}(yield Promise.all(l)).forEach(t=>{t&&s.push(t)});var h=[];s.forEach(t=>{t.properties.count<this.config.clusterMin&&h.push(t.geometry.coordinates)}),yield this.getMarkers(h,e)}else{var c=this.getOSMBoundingBox(e,n),f=c[0],p=c[1],y=c[2],d=c[3],g=`geo.intersects(${"Things"==r.entityType?"Locations/location":"feature"},geography'POLYGON ((${f} ${p}, ${f} ${d}, ${y} ${d}, ${y} ${p} ,${f} ${p}))')`;r.filter?r.filter=`(${r.filter}) and ${g}`:r.filter=g,r.top||(r.top=1e3);var m=yield this.api.getGeoJson(r);if(m)("Things"==r.entityType?m.value.map(t=>t.Locations[0].location):m.value.map(t=>"Point"==t.feature.type?{type:"Feature",geometry:t.feature}:t.feature)).forEach(t=>{this.addToCache(e,t)})}}))}getMarkers(e,n){return t(this,void 0,void 0,(function*(){if(0!=e.length){var r=JSON.parse(JSON.stringify(this.getQuery(n)));if(r.top=1e3,"Things"==r.entityType){r.expand||(r.expand=[]);var i=r.expand.find(t=>"Datastreams"==t.entityType);i?(i.select||(i.select=["id","name","unitOfMeasurement"]),i.select.includes("id")||i.select.push("id"),i.select.includes("name")||i.select.push("name"),i.select.includes("unitOfMeasurement")||i.select.push("unitOfMeasurement")):r.expand.push({entityType:"Datastreams",select:["id","name","unitOfMeasurement"],expand:[{entityType:"observedProperty"}]}),r.expand.some(t=>"Locations"==t.entityType)||r.expand.push({entityType:"Locations"})}else r.select&&!r.select.includes("feature")&&r.select.push("feature"),r.expand=[{entityType:"Observations",top:1,expand:[{entityType:"Datastream",select:["unitOfMeasurement","id"],expand:[{entityType:"observedProperty"}]}]}];r.filter&&(r.filter=`(${r.filter}) and `);var o=[];for(var s of e){var l=JSON.parse(JSON.stringify(r));l.filter=Qt(s,l.entityType),o.push(new Promise((e,i)=>t(this,void 0,void 0,(function*(){(yield this.api.getGeoJson(l)).value.forEach(t=>{var e;if("Point"==(e="Things"==r.entityType?t.Locations[0].location:t.feature).type&&(e={type:"Feature",geometry:e}),delete t.Locations,e.properties=t,t.getData||(t.getData={}),"Things"==r.entityType)for(var i of t.Datastreams)this.addGetDataCallback(i,t);else{const e=t.Observations[0].Datastream;this.addGetDataCallback(e,t)}this.getCached(n).features.some(t=>Zt(e,t))||this.addToCache(n,e)}),e()}))))}yield Promise.all(o)}}))}addGetDataCallback(e,n){const r=e["@iot.id"],i=e.unitOfMeasurement;n.getData[e.ObservedProperty.name]=function(e){var n={entityType:"Datastreams",id:r,pathSuffix:"Observations"};return n=e(n),new Promise((e,r)=>t(this,void 0,void 0,(function*(){var t=yield this.api.getGeoJson(n);t.unitOfMeasurement=i,e(t)})))}.bind(this)}getCached(t){this.config.cachingDuration&&(this.cache=this.cache.filter(function(t){var e=new Date(t.timestamp);return e.setSeconds(t.timestamp.getSeconds()+this.config.cachingDuration),e>new Date}.bind(this)));var e={type:"FeatureCollection",features:[]};for(var n of this.cache)n.zoom==t&&e.features.push(n.geoJson);return e}addToCache(t,e){this.cache.push({geoJson:e,zoom:t,timestamp:new Date}),this.emitChange(t)}emitChange(t){var e=this.getCached(t);e.features=this.getCached(t).features.filter(t=>{var e;return null==t.properties.count||(null===(e=t.properties)||void 0===e?void 0:e.count)>=this.config.clusterMin}),this.emit("change",e)}}function Zt(t,e){return t.type==e.type&&("Point"==t.type?Wt(t.coordinates,e.coordinates):Wt(t.geometry.coordinates,e.geometry.coordinates))}function Wt(t,e){return JSON.stringify(t)===JSON.stringify(e)}function Qt(t,e){return t.map(t=>(null!=t[0][0][0]&&(t=t[0]),`geo.intersects(${"Things"==e?"Locations/location":"feature"},geography'POLYGON ((${t.map(t=>t.join(" ")).join(",")}))')`)).join(" or ")}var Xt={blueIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),goldIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),redIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),greenIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orangeIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellowIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),violetIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),greyIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),blackIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})};function Kt(t){switch(t){case"green":return Xt.greenIcon;case"black":return Xt.blackIcon;case"blue":return Xt.blueIcon;case"grey":return Xt.greyIcon;case"violet":return Xt.violetIcon;case"yellow":return Xt.yellowIcon;case"red":return Xt.redIcon;case"orange":return Xt.orangeIcon;case"gold":return Xt.goldIcon;default:return new L.Icon.Default}}var te="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var ee,ne,re=function(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}((function(t){var e,n;e=te,n=function(){function t(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType}function e(){var t=[];return{watch:t.push.bind(t),trigger:function(e,n){for(var r=!0,i={detail:n,preventDefault:function(){r=!1}},o=0;o<t.length;o++)t[o](e,i);return r}}}function n(t){return"none"===window.getComputedStyle(t).display}function r(t){this.elem=t}function i(t,e){return r.make(t("parent")).clazz("pico-overlay").clazz(t("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(t("overlayStyles",{opacity:.5,background:"#000"})).onClick((function(){t("overlayClose",!0)&&e()}))}r.make=function(t,e){"string"==typeof t&&(t=document.querySelector(t));var n=document.createElement(e||"div");return(t||document.body).appendChild(n),new r(n)},r.prototype={child:function(t){return r.make(this.elem,t)},stylize:function(t){for(var e in void 0!==(t=t||{}).opacity&&(t.filter="alpha(opacity="+100*t.opacity+")"),t)t.hasOwnProperty(e)&&(this.elem.style[e]=t[e]);return this},clazz:function(t){return this.elem.className+=" "+t,this},html:function(e){return t(e)?this.elem.appendChild(e):this.elem.innerHTML=e,this},onClick:function(t){return this.elem.addEventListener("click",t),this},destroy:function(){this.elem.parentNode.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(t,e){return void 0!==e&&this.elem.setAttribute(t,e),this},anyAncestor:function(t){for(var e=this.elem;e;){if(t(new r(e)))return!0;e=e.parentNode}return!1},isVisible:function(){return!n(this.elem)}};var o=1;function s(t,e){if(e("closeButton",!0))return t.child("button").html(e("closeHtml","&#xD7;")).clazz("pico-close").clazz(e("closeClass","")).stylize(e("closeStyles",{borderRadius:"2px",border:0,padding:0,cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"})).attr("aria-label",e("close-label","Close"))}function l(t){return function(){return t().elem}}var a=e(),u=e();function h(t,e){function r(t,e){return(t.msMatchesSelector||t.webkitMatchesSelector||t.matches).call(t,e)}function i(t){return!(n(t)||r(t,":disabled")||t.hasAttribute("contenteditable"))&&(t.hasAttribute("tabindex")||r(t,"input,select,textarea,button,a[href],area[href],iframe"))}function o(t){for(var e=t.getElementsByTagName("*"),n=0;n<e.length;n++)if(i(e[n]))return e[n]}var s;t.beforeShow((function(){s=document.activeElement})),t.afterShow((function(){if(e()){var n=o(t.modalElem());n&&n.focus()}})),t.afterClose((function(){e()&&s&&s.focus(),s=null})),u.watch((function(n){if(e()&&t.isVisible()){var r=o(t.modalElem()),s=function(t){for(var e=t.getElementsByTagName("*"),n=e.length;n--;)if(i(e[n]))return e[n]}(t.modalElem());(n.shiftKey?r:s)===document.activeElement&&((n.shiftKey?s:r).focus(),n.preventDefault())}}))}return document.documentElement.addEventListener("keydown",(function(t){var e=t.which||t.keyCode;27===e?a.trigger():9===e&&u.trigger(t)})),function(n){("string"==typeof n||t(n))&&(n={content:n});var u=e(),c=e(),f=e(),p=e(),y=e();function d(t,e){var r=n[t];return"function"==typeof r&&(r=r(e)),void 0===r?e:r}var g,m,v=k.bind(window,"modal"),b=k.bind(window,"overlay"),w=k.bind(window,"close");function x(t){b().hide(),v().hide(),y.trigger(g,t)}function E(t){p.trigger(g,t)&&x(t)}function S(t){return function(){return t.apply(this,arguments),g}}function k(t,e){if(!m){var n=function(t,e){var n=t("width","auto");"number"==typeof n&&(n+="px");var i=t("modalId","pico-"+o++);return r.make(t("parent")).clazz("pico-content").clazz(t("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"38.1966%",maxHeight:"90%",boxSizing:"border-box",width:n,"-ms-transform":"translate(-50%,-38.1966%)","-moz-transform":"translate(-50%,-38.1966%)","-webkit-transform":"translate(-50%,-38.1966%)","-o-transform":"translate(-50%,-38.1966%)",transform:"translate(-50%,-38.1966%)"}).stylize(t("modalStyles",{overflow:"auto",backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(t("content")).attr("id",i).attr("role","dialog").attr("aria-labelledby",t("ariaLabelledBy")).attr("aria-describedby",t("ariaDescribedBy",i)).onClick((function(t){new r(t.target).anyAncestor((function(t){return/\bpico-close\b/.test(t.elem.className)}))&&e()}))}(d,E);m={modal:n,overlay:i(d,E),close:s(n,d)},u.trigger(g,e)}return m[t]}return h(g={modalElem:l(v),closeElem:l(w),overlayElem:l(b),buildDom:S(k.bind(null,null)),isVisible:function(){return!!(m&&v&&v().isVisible())},show:function(t){return c.trigger(g,t)&&(b().show(),w(),v().show(),f.trigger(g,t)),this},close:S(E),forceClose:S(x),destroy:function(){v().destroy(),b().destroy(),b=v=w=void 0},options:function(t){Object.keys(t).map((function(e){n[e]=t[e]}))},afterCreate:S(u.watch),beforeShow:S(c.watch),afterShow:S(f.watch),beforeClose:S(p.watch),afterClose:S(y.watch)},d.bind(null,"focus",!0)),function(t,e){var n,i=new r(document.body);t.beforeShow((function(){n=i.elem.style.overflow,e()&&i.stylize({overflow:"hidden"})})),t.afterClose((function(){i.stylize({overflow:n})}))}(g,d.bind(null,"bodyOverflow",!0)),a.watch((function(){d("escCloses",!0)&&g.isVisible()&&g.close()})),g}},t.exports?t.exports=n():e.picoModal=n()}));if("undefined"!=typeof L){var ie,oe;L.Stam=L.LayerGroup.extend({initialize:function(t){var e,n=new Yt(t),r=function(t){t.setStyle(i.default),e=null},i={default:{opacity:0,fillOpacity:0},highlight:{color:"red",opacity:1}};this.on("add",(function(){if(null!=this._map){var o,s=this._map,l=s.getZoom();ie=L.layerGroup();var a=(n,l)=>{var a;if(o&&(ie.clearLayers(),o=!1),"Polygon"==(null===(a=n.geometry)||void 0===a?void 0:a.type)&&n.properties.count){l.on("mouseover",(function(){t.clusterMouseOver&&t.clusterMouseOver(n),function(t){e&&r(e),t.setStyle(i.highlight),e=t}(l)})),l.on("mouseout",(function(){r(l)})),l.on("click",(function(){if(t.clusterClick)return t.clusterClick(n);s.fitBounds(l.getBounds())})),l.setStyle(i.default);var u=l.getBounds(),h=(u._northEast.lat+u._southWest.lat)/2,c=(u._northEast.lng+u._southWest.lng)/2,f=L.circleMarker(L.latLng(h,c),{radius:127/3});f.bindTooltip(`<span>${n.properties.count}</span>`,{permanent:!0,direction:"center",className:"count"}),ie.addLayer(f)}else{l.on("popupopen",(function(){fe(document.getElementsByClassName("leaflet-popup-content")[0],n,t)})),l.on("click",(function(){var e=!0;if(t.markerClick){var r=t.markerClick(n);r&&(e=!1,l.bindPopup(r))}e&&l.bindPopup("<h3>"+n.properties.name+"</h3>")})),l.on("mouseover",(function(){if(t.markerMouseOver)return t.markerMouseOver(n)}))}},u=function(e,n){return L.marker(n,{icon:"function"==typeof t.markerStyle?Kt(t.markerStyle(e)):"string"==typeof t.markerStyle?Kt(t.markerStyle):new L.Icon.Default})};s.on("layeradd",(function(){s.off("layeradd"),oe=L.geoJSON(null,{onEachFeature:a,pointToLayer:u,style:t.clusterStyle}),this.addLayer(ie),this.addLayer(oe);var e=s.getBounds();n.getLayerData(s.getZoom(),[e._northEast.lng,e._northEast.lat,e._southWest.lng,e._southWest.lat])})),n.on("change",function(t){oe.clearLayers(),oe.addData(t),o=!0}.bind(this)),s.on("moveend",(function(){l!=s.getZoom()&&(l=s.getZoom()),o=!0;var t=s.getBounds();n.getLayerData(s.getZoom(),[t._northEast.lng,t._northEast.lat,t._southWest.lng,t._southWest.lat])}))}}))}}),L.stam=function(t){return new L.Stam(t)};var se=".leaflet-tooltip.count {background-color: transparent;border: transparent;  box-shadow: none;  font-weight: bold;font-size: 20px;}",le=document.head||document.getElementsByTagName("head")[0],ae=document.createElement("style");le.appendChild(ae),ae.type="text/css",ae.styleSheet?ae.styleSheet.cssText=se:ae.appendChild(document.createTextNode(se))}if("undefined"!=typeof ol){se='.ol-popup{position:absolute;min-width:180px;background-color:#fff;-webkit-filter:drop-shadow(0 1px 4px rgba(0, 0, 0, .2));filter:drop-shadow(0 1px 4px rgba(0, 0, 0, .2));padding:15px;border-radius:10px;border:1px solid #ccc;bottom:40px;left:-50px}.ol-popup:after,.ol-popup:before{top:100%;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none}.ol-popup:after{border-top-color:#fff;border-width:10px;left:48px;margin-left:-10px}.ol-popup:before{border-top-color:#ccc;border-width:11px;left:48px;margin-left:-11px}.ol-popup-closer{text-decoration:none;position:absolute;top:2px;right:8px}.ol-popup-closer:after{content:"✖"}',le=document.head||document.getElementsByTagName("head")[0],ae=document.createElement("style");le.appendChild(ae),ae.type="text/css",ae.styleSheet?ae.styleSheet.cssText=se:ae.appendChild(document.createTextNode(se));var ue,he,ce=function(t){he=t.map,ol.layer.Group.call(this,t),ue=he.getView().getZoom().toFixed(0);var e=new Yt(t),n=!1,r=new ol.layer.Vector({source:new ol.source.Vector}),i=new ol.layer.Vector({source:new ol.source.Vector,style:function(e){if(n&&(n=!1,r.getSource().clear()),"Point"==e.getGeometry().getType())return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],scale:.5,anchorXUnits:"fraction",anchorYUnits:"fraction",src:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${"function"==typeof t.markerStyle?t.markerStyle(pe(e)):t.markerStyle?t.markerStyle:"blue"}.png`})});if(null!=e.get("count")){var i=e.getGeometry().getExtent(),o=(i[0]+i[2])/2,s=(i[1]+i[3])/2,l=new ol.Feature({geometry:new ol.geom.Circle([o,s],(i[2]-i[0])/6),name:"cluster"});return l.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({width:2,color:"red",radius:1}),text:new ol.style.Text({font:"30px Calibri,sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),text:""+e.get("count")})})),r.getSource().addFeature(l),new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:3}),fill:new ol.style.Fill({color:"rgba(0, 0, 0, 0)"})})}}}),o=new ol.layer.Group({layers:[r,i]});he.addLayer(o);var s=new ol.format.GeoJSON({featureProjection:he.getView().getProjection().getCode()});e.on("change",t=>{i.getSource().clear(),n=!0,i.getSource().addFeatures(s.readFeatures(t))}),document.getElementById("popup")||document.writeln('<div id="popup" class="ol-popup">\n      <a href="#" id="popup-closer" class="ol-popup-closer"></a>\n      <div id="popup-content"></div>\n      </div>');var l=document.getElementById("popup"),a=document.getElementById("popup-content"),u=document.getElementById("popup-closer");u.onclick=function(){return h.setPosition(void 0),u.blur(),!1};var h=new ol.Overlay({element:l,autoPan:!0,offset:[0,-10]});he.addOverlay(h);var c=null,f=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.7)"}),stroke:new ol.style.Stroke({color:"#3399CC",width:3})}),p=null;he.on("pointermove",(function(e){null!==c&&(c.setStyle(void 0),c=null);var n=he.forEachFeatureAtPixel(e.pixel,(function(e){if(e.get("count"))return p!=e&&(p=e,t.clusterMouseOver&&t.clusterMouseOver(pe(e))),c=e,e.setStyle(f),e;e.get("@iot.id")&&p!=e&&(p=e,t.markerMouseOver&&t.markerMouseOver(pe(e)))}));this.getTargetElement().style.cursor=n?"pointer":""})),he.on("click",(function(e){var n=he.forEachFeatureAtPixel(e.pixel,(function(t){return t}));if(n)if(null!=n.get("@iot.id")){var r,i=n.getGeometry().getCoordinates();"function"==typeof t.markerClick&&(r=t.markerClick(pe(n))),r?a.innerHTML=r:fe(a,pe(n),t),h.setPosition(i)}else null!=n.get("count")&&("function"==typeof t.clusterClick?null==t||t.clusterClick(pe(n)):he.getView().fit(n.getGeometry().getExtent(),he.getSize(),{duration:1e3}))})),he.on("moveend",(function(){ue!=he.getView().getZoom()&&(ue=he.getView().getZoom().toFixed(0)),function(t,e,n,r){var i;if("EPSG:4326"==he.getView().getProjection().getCode())i=he.getView().calculateExtent();else{var o=he.getView().calculateExtent(),s=he.getView().getProjection().getCode();(i=[]).push(...new ol.geom.Point([o[2],o[3]]).transform(s,"EPSG:4326").getCoordinates()),i.push(...new ol.geom.Point([o[0],o[1]]).transform(s,"EPSG:4326").getCoordinates())}t.getLayerData(e,i)}(e,ue)}))};ee=ce,ne=ol.layer.Group,ee.prototype=Object.create(ne.prototype),ee.prototype.constructor=ee,ol.layer.STAM=ce}function fe(e,n,r){e.innerHTML="<h3>"+n.properties.name+"</h3>";var i=document.createElement("ul");Object.keys(n.properties.getData).forEach((function(e){var o=document.createElement("li");o.innerText=e,o.setAttribute("style","cursor: pointer"),"undefined"!=typeof Plotly&&(o.onclick=function(){re({width:1140,content:"",modalId:"pico-1"}).beforeClose((function(){Plotly.purge("pico-1"),document.getElementById("pico-1").remove()})).afterShow((function(){return t(this,void 0,void 0,(function*(){var t=!1,i=yield n.properties.getData[e]((function(e){if(e.resultFormat="dataArray",e.orderby="phenomenonTime asc",r.plot){var n="gt";r.plot.offset?(e.top=Math.abs(r.plot.offset),-1==Math.sign(r.plot.offset)&&(t=!0,e.orderby="phenomenonTime desc",n="lt"),e.filter=`phenomenonTime ${n} ${r.plot.startDate.toISOString()}`):r.plot.endDate&&(e.filter=`(phenomenonTime gt ${r.plot.startDate.toISOString()}) and (phenomenonTime lt ${r.plot.endDate.toISOString()})`)}return e})),o=[],s=[],l=i.value;t&&(l.dataArray=l.dataArray.reverse()),l.dataArray.forEach(t=>{-1!=t[1].indexOf("/")?(o.push(t[1].split("/")[0]),o.push(t[1].split("/")[1]),s.push(t[2])):o.push(t[1]),s.push(t[2])});var a=[{x:o,y:s,type:"scatter"}],u={height:300,xaxis:{autorange:!0},yaxis:{autorange:!0,title:{text:i.unitOfMeasurement.name}},autosize:!0};Plotly.newPlot("pico-1",a,u)}))})).show()}),i.appendChild(o)})),e.appendChild(i)}function pe(t){return{type:t.getGeometry().getType(),properties:t.getProperties(),geometry:{type:"Point",coordinates:t.getGeometry().getCoordinates()}}}}();
